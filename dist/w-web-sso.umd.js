/*!
 * w-web-sso v1.0.7
 * (c) 2018-2021 yuda-lyu(semisphere)
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("path"),require("fs"),require("@hapi/hapi"),require("@hapi/inert"),require("events"),require("stream")):"function"==typeof define&&define.amd?define(["path","fs","@hapi/hapi","@hapi/inert","events","stream"],t):(e="undefined"!=typeof globalThis?globalThis:e||self)["w-web-sso"]=t(e.path,e.fs,e["@hapi/hapi"],e["@hapi/inert"],e.events,e.stream)}(this,(function(e,t,r,n,o,i){"use strict";var a="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function s(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var u={exports:{}};!function(e,t){e.exports=function(){var e=1e3,t=6e4,r=36e5,n="millisecond",o="second",i="minute",a="hour",s="day",u="week",c="month",l="quarter",f="year",d="date",p="Invalid Date",h=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,g=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,v={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(e){var t=["th","st","nd","rd"],r=e%100;return"["+e+(t[(r-20)%10]||t[r]||t[0])+"]"}},y=function(e,t,r){var n=String(e);return!n||n.length>=t?e:""+Array(t+1-n.length).join(r)+e},m={s:y,z:function(e){var t=-e.utcOffset(),r=Math.abs(t),n=Math.floor(r/60),o=r%60;return(t<=0?"+":"-")+y(n,2,"0")+":"+y(o,2,"0")},m:function e(t,r){if(t.date()<r.date())return-e(r,t);var n=12*(r.year()-t.year())+(r.month()-t.month()),o=t.clone().add(n,c),i=r-o<0,a=t.clone().add(n+(i?-1:1),c);return+(-(n+(r-o)/(i?o-a:a-o))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:c,y:f,w:u,d:s,D:d,h:a,m:i,s:o,ms:n,Q:l}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},b="en",w={};w[b]=v;var j="$isDayjsObject",k=function(e){return e instanceof _||!(!e||!e[j])},S=function e(t,r,n){var o;if(!t)return b;if("string"==typeof t){var i=t.toLowerCase();w[i]&&(o=i),r&&(w[i]=r,o=i);var a=t.split("-");if(!o&&a.length>1)return e(a[0])}else{var s=t.name;w[s]=t,o=s}return!n&&o&&(b=o),o||!n&&b},O=function(e,t){if(k(e))return e.clone();var r="object"==typeof t?t:{};return r.date=e,r.args=arguments,new _(r)},x=m;x.l=S,x.i=k,x.w=function(e,t){return O(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var _=function(){function v(e){this.$L=S(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[j]=!0}var y=v.prototype;return y.parse=function(e){this.$d=function(e){var t=e.date,r=e.utc;if(null===t)return new Date(NaN);if(x.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var n=t.match(h);if(n){var o=n[2]-1||0,i=(n[7]||"0").substring(0,3);return r?new Date(Date.UTC(n[1],o,n[3]||1,n[4]||0,n[5]||0,n[6]||0,i)):new Date(n[1],o,n[3]||1,n[4]||0,n[5]||0,n[6]||0,i)}}return new Date(t)}(e),this.init()},y.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},y.$utils=function(){return x},y.isValid=function(){return!(this.$d.toString()===p)},y.isSame=function(e,t){var r=O(e);return this.startOf(t)<=r&&r<=this.endOf(t)},y.isAfter=function(e,t){return O(e)<this.startOf(t)},y.isBefore=function(e,t){return this.endOf(t)<O(e)},y.$g=function(e,t,r){return x.u(e)?this[t]:this.set(r,e)},y.unix=function(){return Math.floor(this.valueOf()/1e3)},y.valueOf=function(){return this.$d.getTime()},y.startOf=function(e,t){var r=this,n=!!x.u(t)||t,l=x.p(e),p=function(e,t){var o=x.w(r.$u?Date.UTC(r.$y,t,e):new Date(r.$y,t,e),r);return n?o:o.endOf(s)},h=function(e,t){return x.w(r.toDate()[e].apply(r.toDate("s"),(n?[0,0,0,0]:[23,59,59,999]).slice(t)),r)},g=this.$W,v=this.$M,y=this.$D,m="set"+(this.$u?"UTC":"");switch(l){case f:return n?p(1,0):p(31,11);case c:return n?p(1,v):p(0,v+1);case u:var b=this.$locale().weekStart||0,w=(g<b?g+7:g)-b;return p(n?y-w:y+(6-w),v);case s:case d:return h(m+"Hours",0);case a:return h(m+"Minutes",1);case i:return h(m+"Seconds",2);case o:return h(m+"Milliseconds",3);default:return this.clone()}},y.endOf=function(e){return this.startOf(e,!1)},y.$set=function(e,t){var r,u=x.p(e),l="set"+(this.$u?"UTC":""),p=(r={},r[s]=l+"Date",r[d]=l+"Date",r[c]=l+"Month",r[f]=l+"FullYear",r[a]=l+"Hours",r[i]=l+"Minutes",r[o]=l+"Seconds",r[n]=l+"Milliseconds",r)[u],h=u===s?this.$D+(t-this.$W):t;if(u===c||u===f){var g=this.clone().set(d,1);g.$d[p](h),g.init(),this.$d=g.set(d,Math.min(this.$D,g.daysInMonth())).$d}else p&&this.$d[p](h);return this.init(),this},y.set=function(e,t){return this.clone().$set(e,t)},y.get=function(e){return this[x.p(e)]()},y.add=function(n,l){var d,p=this;n=Number(n);var h=x.p(l),g=function(e){var t=O(p);return x.w(t.date(t.date()+Math.round(e*n)),p)};if(h===c)return this.set(c,this.$M+n);if(h===f)return this.set(f,this.$y+n);if(h===s)return g(1);if(h===u)return g(7);var v=(d={},d[i]=t,d[a]=r,d[o]=e,d)[h]||1,y=this.$d.getTime()+n*v;return x.w(y,this)},y.subtract=function(e,t){return this.add(-1*e,t)},y.format=function(e){var t=this,r=this.$locale();if(!this.isValid())return r.invalidDate||p;var n=e||"YYYY-MM-DDTHH:mm:ssZ",o=x.z(this),i=this.$H,a=this.$m,s=this.$M,u=r.weekdays,c=r.months,l=r.meridiem,f=function(e,r,o,i){return e&&(e[r]||e(t,n))||o[r].slice(0,i)},d=function(e){return x.s(i%12||12,e,"0")},h=l||function(e,t,r){var n=e<12?"AM":"PM";return r?n.toLowerCase():n};return n.replace(g,(function(e,n){return n||function(e){switch(e){case"YY":return String(t.$y).slice(-2);case"YYYY":return x.s(t.$y,4,"0");case"M":return s+1;case"MM":return x.s(s+1,2,"0");case"MMM":return f(r.monthsShort,s,c,3);case"MMMM":return f(c,s);case"D":return t.$D;case"DD":return x.s(t.$D,2,"0");case"d":return String(t.$W);case"dd":return f(r.weekdaysMin,t.$W,u,2);case"ddd":return f(r.weekdaysShort,t.$W,u,3);case"dddd":return u[t.$W];case"H":return String(i);case"HH":return x.s(i,2,"0");case"h":return d(1);case"hh":return d(2);case"a":return h(i,a,!0);case"A":return h(i,a,!1);case"m":return String(a);case"mm":return x.s(a,2,"0");case"s":return String(t.$s);case"ss":return x.s(t.$s,2,"0");case"SSS":return x.s(t.$ms,3,"0");case"Z":return o}return null}(e)||o.replace(":","")}))},y.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},y.diff=function(n,d,p){var h,g=this,v=x.p(d),y=O(n),m=(y.utcOffset()-this.utcOffset())*t,b=this-y,w=function(){return x.m(g,y)};switch(v){case f:h=w()/12;break;case c:h=w();break;case l:h=w()/3;break;case u:h=(b-m)/6048e5;break;case s:h=(b-m)/864e5;break;case a:h=b/r;break;case i:h=b/t;break;case o:h=b/e;break;default:h=b}return p?h:x.a(h)},y.daysInMonth=function(){return this.endOf(c).$D},y.$locale=function(){return w[this.$L]},y.locale=function(e,t){if(!e)return this.$L;var r=this.clone(),n=S(e,t,!0);return n&&(r.$L=n),r},y.clone=function(){return x.w(this.$d,this)},y.toDate=function(){return new Date(this.valueOf())},y.toJSON=function(){return this.isValid()?this.toISOString():null},y.toISOString=function(){return this.$d.toISOString()},y.toString=function(){return this.$d.toUTCString()},v}(),A=_.prototype;return O.prototype=A,[["$ms",n],["$s",o],["$m",i],["$H",a],["$W",s],["$M",c],["$y",f],["$D",d]].forEach((function(e){A[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),O.extend=function(e,t){return e.$i||(e(t,_,O),e.$i=!0),O},O.locale=S,O.isDayjs=k,O.unix=function(e){return O(1e3*e)},O.en=w[b],O.Ls=w,O.p={},O}()}(u);var c=s(u.exports),l=Array.isArray,f="object"==typeof global&&global&&global.Object===Object&&global,d="object"==typeof self&&self&&self.Object===Object&&self,p=f||d||Function("return this")(),h=p.Symbol,g=Object.prototype,v=g.hasOwnProperty,y=g.toString,m=h?h.toStringTag:void 0;var b=Object.prototype.toString;var w="[object Null]",j="[object Undefined]",k=h?h.toStringTag:void 0;function S(e){return null==e?void 0===e?j:w:k&&k in Object(e)?function(e){var t=v.call(e,m),r=e[m];try{e[m]=void 0;var n=!0}catch(e){}var o=y.call(e);return n&&(t?e[m]=r:delete e[m]),o}(e):function(e){return b.call(e)}(e)}function O(e){return null!=e&&"object"==typeof e}var x="[object Symbol]";function _(e){return"symbol"==typeof e||O(e)&&S(e)==x}var A=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,T=/^\w*$/;function I(e,t){if(l(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!_(e))||(T.test(e)||!A.test(e)||null!=t&&e in Object(t))}function $(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var M="[object AsyncFunction]",E="[object Function]",P="[object GeneratorFunction]",D="[object Proxy]";function C(e){if(!$(e))return!1;var t=S(e);return t==E||t==P||t==M||t==D}var U,N=p["__core-js_shared__"],B=(U=/[^.]+$/.exec(N&&N.keys&&N.keys.IE_PROTO||""))?"Symbol(src)_1."+U:"";var F=Function.prototype.toString;function R(e){if(null!=e){try{return F.call(e)}catch(e){}try{return e+""}catch(e){}}return""}var L=/^\[object .+?Constructor\]$/,W=Function.prototype,z=Object.prototype,H=W.toString,G=z.hasOwnProperty,Y=RegExp("^"+H.call(G).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function V(e){return!(!$(e)||(t=e,B&&B in t))&&(C(e)?Y:L).test(R(e));var t}function q(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return V(r)?r:void 0}var Z=q(Object,"create");var J=Object.prototype.hasOwnProperty;var X=Object.prototype.hasOwnProperty;function Q(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function K(e,t){return e===t||e!=e&&t!=t}function ee(e,t){for(var r=e.length;r--;)if(K(e[r][0],t))return r;return-1}Q.prototype.clear=function(){this.__data__=Z?Z(null):{},this.size=0},Q.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Q.prototype.get=function(e){var t=this.__data__;if(Z){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return J.call(t,e)?t[e]:void 0},Q.prototype.has=function(e){var t=this.__data__;return Z?void 0!==t[e]:X.call(t,e)},Q.prototype.set=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=Z&&void 0===t?"__lodash_hash_undefined__":t,this};var te=Array.prototype.splice;function re(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}re.prototype.clear=function(){this.__data__=[],this.size=0},re.prototype.delete=function(e){var t=this.__data__,r=ee(t,e);return!(r<0)&&(r==t.length-1?t.pop():te.call(t,r,1),--this.size,!0)},re.prototype.get=function(e){var t=this.__data__,r=ee(t,e);return r<0?void 0:t[r][1]},re.prototype.has=function(e){return ee(this.__data__,e)>-1},re.prototype.set=function(e,t){var r=this.__data__,n=ee(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};var ne=q(p,"Map");function oe(e,t){var r,n,o=e.__data__;return("string"==(n=typeof(r=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?o["string"==typeof t?"string":"hash"]:o.map}function ie(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}ie.prototype.clear=function(){this.size=0,this.__data__={hash:new Q,map:new(ne||re),string:new Q}},ie.prototype.delete=function(e){var t=oe(this,e).delete(e);return this.size-=t?1:0,t},ie.prototype.get=function(e){return oe(this,e).get(e)},ie.prototype.has=function(e){return oe(this,e).has(e)},ie.prototype.set=function(e,t){var r=oe(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};var ae="Expected a function";function se(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(ae);var r=function(){var n=arguments,o=t?t.apply(this,n):n[0],i=r.cache;if(i.has(o))return i.get(o);var a=e.apply(this,n);return r.cache=i.set(o,a)||i,a};return r.cache=new(se.Cache||ie),r}se.Cache=ie;var ue,ce,le,fe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,de=/\\(\\)?/g,pe=(ue=function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(fe,(function(e,r,n,o){t.push(n?o.replace(de,"$1"):r||e)})),t},ce=se(ue,(function(e){return 500===le.size&&le.clear(),e})),le=ce.cache,ce),he=pe;function ge(e,t){for(var r=-1,n=null==e?0:e.length,o=Array(n);++r<n;)o[r]=t(e[r],r,e);return o}var ve=1/0,ye=h?h.prototype:void 0,me=ye?ye.toString:void 0;function be(e){if("string"==typeof e)return e;if(l(e))return ge(e,be)+"";if(_(e))return me?me.call(e):"";var t=e+"";return"0"==t&&1/e==-ve?"-0":t}function we(e){return null==e?"":be(e)}function je(e,t){return l(e)?e:I(e,t)?[e]:he(we(e))}var ke=1/0;function Se(e){if("string"==typeof e||_(e))return e;var t=e+"";return"0"==t&&1/e==-ke?"-0":t}function Oe(e,t){for(var r=0,n=(t=je(t,e)).length;null!=e&&r<n;)e=e[Se(t[r++])];return r&&r==n?e:void 0}function xe(e,t,r){var n=null==e?void 0:Oe(e,t);return void 0===n?r:n}function _e(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););return e}var Ae,Te=function(e,t,r){for(var n=-1,o=Object(e),i=r(e),a=i.length;a--;){var s=i[Ae?a:++n];if(!1===t(o[s],s,o))break}return e};function Ie(e){return O(e)&&"[object Arguments]"==S(e)}var $e=Object.prototype,Me=$e.hasOwnProperty,Ee=$e.propertyIsEnumerable,Pe=Ie(function(){return arguments}())?Ie:function(e){return O(e)&&Me.call(e,"callee")&&!Ee.call(e,"callee")},De=Pe;var Ce="object"==typeof exports&&exports&&!exports.nodeType&&exports,Ue=Ce&&"object"==typeof module&&module&&!module.nodeType&&module,Ne=Ue&&Ue.exports===Ce?p.Buffer:void 0,Be=(Ne?Ne.isBuffer:void 0)||function(){return!1},Fe=9007199254740991,Re=/^(?:0|[1-9]\d*)$/;function Le(e,t){var r=typeof e;return!!(t=null==t?Fe:t)&&("number"==r||"symbol"!=r&&Re.test(e))&&e>-1&&e%1==0&&e<t}var We=9007199254740991;function ze(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=We}var He={};function Ge(e){return function(t){return e(t)}}He["[object Float32Array]"]=He["[object Float64Array]"]=He["[object Int8Array]"]=He["[object Int16Array]"]=He["[object Int32Array]"]=He["[object Uint8Array]"]=He["[object Uint8ClampedArray]"]=He["[object Uint16Array]"]=He["[object Uint32Array]"]=!0,He["[object Arguments]"]=He["[object Array]"]=He["[object ArrayBuffer]"]=He["[object Boolean]"]=He["[object DataView]"]=He["[object Date]"]=He["[object Error]"]=He["[object Function]"]=He["[object Map]"]=He["[object Number]"]=He["[object Object]"]=He["[object RegExp]"]=He["[object Set]"]=He["[object String]"]=He["[object WeakMap]"]=!1;var Ye="object"==typeof exports&&exports&&!exports.nodeType&&exports,Ve=Ye&&"object"==typeof module&&module&&!module.nodeType&&module,qe=Ve&&Ve.exports===Ye&&f.process,Ze=function(){try{var e=Ve&&Ve.require&&Ve.require("util").types;return e||qe&&qe.binding&&qe.binding("util")}catch(e){}}(),Je=Ze&&Ze.isTypedArray,Xe=Je?Ge(Je):function(e){return O(e)&&ze(e.length)&&!!He[S(e)]},Qe=Object.prototype.hasOwnProperty;function Ke(e,t){var r=l(e),n=!r&&De(e),o=!r&&!n&&Be(e),i=!r&&!n&&!o&&Xe(e),a=r||n||o||i,s=a?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],u=s.length;for(var c in e)!t&&!Qe.call(e,c)||a&&("length"==c||o&&("offset"==c||"parent"==c)||i&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||Le(c,u))||s.push(c);return s}var et=Object.prototype;function tt(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||et)}function rt(e,t){return function(r){return e(t(r))}}var nt=rt(Object.keys,Object),ot=Object.prototype.hasOwnProperty;function it(e){if(!tt(e))return nt(e);var t=[];for(var r in Object(e))ot.call(e,r)&&"constructor"!=r&&t.push(r);return t}function at(e){return null!=e&&ze(e.length)&&!C(e)}function st(e){return at(e)?Ke(e):it(e)}var ut=function(e,t){return function(r,n){if(null==r)return r;if(!at(r))return e(r,n);for(var o=r.length,i=t?o:-1,a=Object(r);(t?i--:++i<o)&&!1!==n(a[i],i,a););return r}}((function(e,t){return e&&Te(e,t,st)})),ct=ut;function lt(e){return e}function ft(e,t){var r;return(l(e)?_e:ct)(e,"function"==typeof(r=t)?r:lt)}var dt=q(p,"DataView"),pt=q(p,"Promise"),ht=q(p,"Set"),gt=q(p,"WeakMap"),vt="[object Map]",yt="[object Promise]",mt="[object Set]",bt="[object WeakMap]",wt="[object DataView]",jt=R(dt),kt=R(ne),St=R(pt),Ot=R(ht),xt=R(gt),_t=S;(dt&&_t(new dt(new ArrayBuffer(1)))!=wt||ne&&_t(new ne)!=vt||pt&&_t(pt.resolve())!=yt||ht&&_t(new ht)!=mt||gt&&_t(new gt)!=bt)&&(_t=function(e){var t=S(e),r="[object Object]"==t?e.constructor:void 0,n=r?R(r):"";if(n)switch(n){case jt:return wt;case kt:return vt;case St:return yt;case Ot:return mt;case xt:return bt}return t});var At=_t,Tt="[object String]";function It(e){return function(t){return null==t?void 0:t[e]}}var $t=It("length"),Mt=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");function Et(e){return Mt.test(e)}var Pt="\\ud800-\\udfff",Dt="["+Pt+"]",Ct="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",Ut="\\ud83c[\\udffb-\\udfff]",Nt="[^"+Pt+"]",Bt="(?:\\ud83c[\\udde6-\\uddff]){2}",Ft="[\\ud800-\\udbff][\\udc00-\\udfff]",Rt="(?:"+Ct+"|"+Ut+")"+"?",Lt="[\\ufe0e\\ufe0f]?",Wt=Lt+Rt+("(?:\\u200d(?:"+[Nt,Bt,Ft].join("|")+")"+Lt+Rt+")*"),zt="(?:"+[Nt+Ct+"?",Ct,Bt,Ft,Dt].join("|")+")",Ht=RegExp(Ut+"(?="+Ut+")|"+zt+Wt,"g");function Gt(e){return Et(e)?function(e){for(var t=Ht.lastIndex=0;Ht.test(e);)++t;return t}(e):$t(e)}var Yt="[object Map]",Vt="[object Set]";function qt(e){if(null==e)return 0;if(at(e))return"string"==typeof(t=e)||!l(t)&&O(t)&&S(t)==Tt?Gt(e):e.length;var t,r=At(e);return r==Yt||r==Vt?e.size:it(e).length}function Zt(e){return"[object Object]"===Object.prototype.toString.call(e)}function Jt(e){if(Zt(e)){for(let t in e)return!0;return!1}return!1}function Xt(e){return"[object String]"===Object.prototype.toString.call(e)}function Qt(e){return!(!Xt(e)||""===e)}var Kt=/\s/;var er=/^\s+/;function tr(e){return e?e.slice(0,function(e){for(var t=e.length;t--&&Kt.test(e.charAt(t)););return t}(e)+1).replace(er,""):e}var rr=NaN,nr=/^[-+]0x[0-9a-f]+$/i,or=/^0b[01]+$/i,ir=/^0o[0-7]+$/i,ar=parseInt;function sr(e){if("number"==typeof e)return e;if(_(e))return rr;if($(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=$(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=tr(e);var r=or.test(e);return r||ir.test(e)?ar(e.slice(2),r?2:8):nr.test(e)?rr:+e}var ur=1/0,cr=17976931348623157e292;function lr(e){return e?(e=sr(e))===ur||e===-ur?(e<0?-1:1)*cr:e==e?e:0:0===e?e:0}function fr(e){var t=lr(e),r=t%1;return t==t?r?t-r:t:0}function dr(e){return e!=e}function pr(e){let t=!1;if(Qt(e))t=!isNaN(Number(e));else if(function(e){return"[object Number]"===Object.prototype.toString.call(e)}(e)){if(dr(e))return!1;t=!0}return t}function hr(e){if(!pr(e))return 0;return lr(e)}function gr(e){return!!pr(e)&&(e=hr(e),"number"==typeof(t=e)&&t==fr(t));var t}var vr=p.isFinite,yr=Math.min;var mr=function(e){var t=Math[e];return function(e,r){if(e=sr(e),(r=null==r?0:yr(fr(r),292))&&vr(e)){var n=(we(e)+"e").split("e");return+((n=(we(t(n[0]+"e"+(+n[1]+r)))+"e").split("e"))[0]+"e"+(+n[1]-r))}return t(e)}}("round"),br=mr;function wr(e){if(!pr(e))return 0;e=hr(e);let t=br(e);return"0"===String(t)?0:t}function jr(e){if(!gr(e))return!1;return wr(e)>0}function kr(e){return"[object Array]"===Object.prototype.toString.call(e)}function Sr(e){return"[object Undefined]"===Object.prototype.toString.call(e)}function Or(e){if(Zt(e)){for(let t in e)return!1;return!0}return!1}function xr(e){return!!Sr(e)||(!!function(e){return"[object Null]"===Object.prototype.toString.call(e)}(e)||(!!Or(e)||(!!function(e){return!(!Xt(e)||""!==e)}(e)||(!!function(e){return!!kr(e)&&0===e.length}(e)||!!dr(e)))))}function _r(e){return!!kr(e)&&(0!==e.length&&(1!==e.length||!xr(e[0])))}function Ar(e){let t=Object.prototype.toString.call(e);return"[object Function]"===t||"[object AsyncFunction]"===t}function Tr(e){let t,r=Object.prototype.toString.call(e);if(t="[object Promise]"===r,t)return!0;if("[object Function]"!==r)return!1;try{t="function"!=typeof e.subscribe&&"function"==typeof e.then}catch(e){}return t}function Ir(e){if(!Qt(e))return{};let t={};try{t=JSON.parse(e)}catch(e){t={}}return t}function $r(e){if(!gr(e))return!1;return wr(e)>=0}function Mr(e,t){return Qt(e)&&$r(t)?0===(t=wr(t))?"":e.substring(0,t):""}function Er(){let e,t,r=new Promise((function(){e=arguments[0],t=arguments[1]}));return r.resolve=e,r.reject=t,r}let Pr=function(e){if(!Ar(e))throw new Error("fn is not a function");return function(){let t=Er(),r=null,n=null;try{r=e.apply(this,arguments)}catch(e){n=e}return null!==n?t.resolve({state:"error",msg:n}):Tr(r)?r.then((e=>{t.resolve({state:"success",msg:e})})).catch((e=>{"cancelled"===xe(e,"reason")?t.resolve({state:"cancelled",msg:""}):t.resolve({state:"error",msg:e})})):t.resolve({state:"success",msg:r}),t}};function Dr(e,t,r){var n=-1,o=e.length;t<0&&(t=-t>o?0:o+t),(r=r>o?o:r)<0&&(r+=o),o=t>r?0:r-t>>>0,t>>>=0;for(var i=Array(o);++n<o;)i[n]=e[n+t];return i}function Cr(e,t){let r=Er();if(!kr(e)&&!Zt(e))return r.reject("rs is not an array or object"),r;let n=!1;if(Zt(e)){n=!0;let t=[];ft(e,((e,r)=>{t.push({k:r,v:e})})),e=t}Ar(t)||(t=function(e){return e});let o=-1,i=[];return e.reduce((function(e,r){return e.then((function(e){i.push(e),o+=1;let a=o,s=r;return n&&(a=r.k,s=r.v),Ar(t)?t(s,a):s}))}),Promise.resolve()).then((function(e){var t,n,o,a;i.push(e),a=null==(t=i)?0:t.length,i=a?Dr(t,(n=o||void 0===n?1:fr(n))<0?0:n,a):[],r.resolve(i)})).catch((function(e){r.reject(e)})),r}function Ur(e){return!!t.existsSync(e)&&(!t.lstatSync(e).isDirectory()&&!t.lstatSync(e).isSymbolicLink())}function Nr(e,t,r){if(!Qt(e))return"";if(!Qt(t))return"";if(!Xt(r))return"";return String(e).replaceAll(t,r)}var Br="[object Boolean]";function Fr(e){return!0===(t=e)||!1===t||O(t)&&S(t)==Br;var t}var Rr={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}function o(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function i(e,t,n,i,a){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new o(n,i||e,a),u=r?r+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],s]:e._events[u].push(s):(e._events[u]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function s(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),s.prototype.eventNames=function(){var e,n,o=[];if(0===this._eventsCount)return o;for(n in e=this._events)t.call(e,n)&&o.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(e)):o},s.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var o=0,i=n.length,a=new Array(i);o<i;o++)a[o]=n[o].fn;return a},s.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},s.prototype.emit=function(e,t,n,o,i,a){var s=r?r+e:e;if(!this._events[s])return!1;var u,c,l=this._events[s],f=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),f){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,o),!0;case 5:return l.fn.call(l.context,t,n,o,i),!0;case 6:return l.fn.call(l.context,t,n,o,i,a),!0}for(c=1,u=new Array(f-1);c<f;c++)u[c-1]=arguments[c];l.fn.apply(l.context,u)}else{var d,p=l.length;for(c=0;c<p;c++)switch(l[c].once&&this.removeListener(e,l[c].fn,void 0,!0),f){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,t);break;case 3:l[c].fn.call(l[c].context,t,n);break;case 4:l[c].fn.call(l[c].context,t,n,o);break;default:if(!u)for(d=1,u=new Array(f-1);d<f;d++)u[d-1]=arguments[d];l[c].fn.apply(l[c].context,u)}}return!0},s.prototype.on=function(e,t,r){return i(this,e,t,r,!1)},s.prototype.once=function(e,t,r){return i(this,e,t,r,!0)},s.prototype.removeListener=function(e,t,n,o){var i=r?r+e:e;if(!this._events[i])return this;if(!t)return a(this,i),this;var s=this._events[i];if(s.fn)s.fn!==t||o&&!s.once||n&&s.context!==n||a(this,i);else{for(var u=0,c=[],l=s.length;u<l;u++)(s[u].fn!==t||o&&!s[u].once||n&&s[u].context!==n)&&c.push(s[u]);c.length?this._events[i]=1===c.length?c[0]:c:a(this,i)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&a(this,t)):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,e.exports=s}(Rr);var Lr=s(Rr.exports);function Wr(){return new Lr}function zr(e){var t=this.__data__=new re(e);this.size=t.size}zr.prototype.clear=function(){this.__data__=new re,this.size=0},zr.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},zr.prototype.get=function(e){return this.__data__.get(e)},zr.prototype.has=function(e){return this.__data__.has(e)},zr.prototype.set=function(e,t){var r=this.__data__;if(r instanceof re){var n=r.__data__;if(!ne||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new ie(n)}return r.set(e,t),this.size=r.size,this};function Hr(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new ie;++t<r;)this.add(e[t])}function Gr(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}function Yr(e,t){return e.has(t)}Hr.prototype.add=Hr.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},Hr.prototype.has=function(e){return this.__data__.has(e)};var Vr=1,qr=2;function Zr(e,t,r,n,o,i){var a=r&Vr,s=e.length,u=t.length;if(s!=u&&!(a&&u>s))return!1;var c=i.get(e),l=i.get(t);if(c&&l)return c==t&&l==e;var f=-1,d=!0,p=r&qr?new Hr:void 0;for(i.set(e,t),i.set(t,e);++f<s;){var h=e[f],g=t[f];if(n)var v=a?n(g,h,f,t,e,i):n(h,g,f,e,t,i);if(void 0!==v){if(v)continue;d=!1;break}if(p){if(!Gr(t,(function(e,t){if(!Yr(p,t)&&(h===e||o(h,e,r,n,i)))return p.push(t)}))){d=!1;break}}else if(h!==g&&!o(h,g,r,n,i)){d=!1;break}}return i.delete(e),i.delete(t),d}var Jr=p.Uint8Array;function Xr(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r}function Qr(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}var Kr=1,en=2,tn="[object Boolean]",rn="[object Date]",nn="[object Error]",on="[object Map]",an="[object Number]",sn="[object RegExp]",un="[object Set]",cn="[object String]",ln="[object Symbol]",fn="[object ArrayBuffer]",dn="[object DataView]",pn=h?h.prototype:void 0,hn=pn?pn.valueOf:void 0;function gn(e,t){for(var r=-1,n=t.length,o=e.length;++r<n;)e[o+r]=t[r];return e}function vn(e,t,r){var n=t(e);return l(e)?n:gn(n,r(e))}function yn(e,t){for(var r=-1,n=null==e?0:e.length,o=0,i=[];++r<n;){var a=e[r];t(a,r,e)&&(i[o++]=a)}return i}function mn(){return[]}var bn=Object.prototype.propertyIsEnumerable,wn=Object.getOwnPropertySymbols,jn=wn?function(e){return null==e?[]:(e=Object(e),yn(wn(e),(function(t){return bn.call(e,t)})))}:mn;function kn(e){return vn(e,st,jn)}var Sn=1,On=Object.prototype.hasOwnProperty;var xn=1,_n="[object Arguments]",An="[object Array]",Tn="[object Object]",In=Object.prototype.hasOwnProperty;function $n(e,t,r,n,o,i){var a=l(e),s=l(t),u=a?An:At(e),c=s?An:At(t),f=(u=u==_n?Tn:u)==Tn,d=(c=c==_n?Tn:c)==Tn,p=u==c;if(p&&Be(e)){if(!Be(t))return!1;a=!0,f=!1}if(p&&!f)return i||(i=new zr),a||Xe(e)?Zr(e,t,r,n,o,i):function(e,t,r,n,o,i,a){switch(r){case dn:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case fn:return!(e.byteLength!=t.byteLength||!i(new Jr(e),new Jr(t)));case tn:case rn:case an:return K(+e,+t);case nn:return e.name==t.name&&e.message==t.message;case sn:case cn:return e==t+"";case on:var s=Xr;case un:var u=n&Kr;if(s||(s=Qr),e.size!=t.size&&!u)return!1;var c=a.get(e);if(c)return c==t;n|=en,a.set(e,t);var l=Zr(s(e),s(t),n,o,i,a);return a.delete(e),l;case ln:if(hn)return hn.call(e)==hn.call(t)}return!1}(e,t,u,r,n,o,i);if(!(r&xn)){var h=f&&In.call(e,"__wrapped__"),g=d&&In.call(t,"__wrapped__");if(h||g){var v=h?e.value():e,y=g?t.value():t;return i||(i=new zr),o(v,y,r,n,i)}}return!!p&&(i||(i=new zr),function(e,t,r,n,o,i){var a=r&Sn,s=kn(e),u=s.length;if(u!=kn(t).length&&!a)return!1;for(var c=u;c--;){var l=s[c];if(!(a?l in t:On.call(t,l)))return!1}var f=i.get(e),d=i.get(t);if(f&&d)return f==t&&d==e;var p=!0;i.set(e,t),i.set(t,e);for(var h=a;++c<u;){var g=e[l=s[c]],v=t[l];if(n)var y=a?n(v,g,l,t,e,i):n(g,v,l,e,t,i);if(!(void 0===y?g===v||o(g,v,r,n,i):y)){p=!1;break}h||(h="constructor"==l)}if(p&&!h){var m=e.constructor,b=t.constructor;m==b||!("constructor"in e)||!("constructor"in t)||"function"==typeof m&&m instanceof m&&"function"==typeof b&&b instanceof b||(p=!1)}return i.delete(e),i.delete(t),p}(e,t,r,n,o,i))}function Mn(e,t,r,n,o){return e===t||(null==e||null==t||!O(e)&&!O(t)?e!=e&&t!=t:$n(e,t,r,n,Mn,o))}var En=1,Pn=2;function Dn(e){return e==e&&!$(e)}function Cn(e,t){return function(r){return null!=r&&(r[e]===t&&(void 0!==t||e in Object(r)))}}function Un(e){var t=function(e){for(var t=st(e),r=t.length;r--;){var n=t[r],o=e[n];t[r]=[n,o,Dn(o)]}return t}(e);return 1==t.length&&t[0][2]?Cn(t[0][0],t[0][1]):function(r){return r===e||function(e,t,r,n){var o=r.length,i=o,a=!n;if(null==e)return!i;for(e=Object(e);o--;){var s=r[o];if(a&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++o<i;){var u=(s=r[o])[0],c=e[u],l=s[1];if(a&&s[2]){if(void 0===c&&!(u in e))return!1}else{var f=new zr;if(n)var d=n(c,l,u,e,t,f);if(!(void 0===d?Mn(l,c,En|Pn,n,f):d))return!1}}return!0}(r,e,t)}}function Nn(e,t){return null!=e&&t in Object(e)}function Bn(e,t){return null!=e&&function(e,t,r){for(var n=-1,o=(t=je(t,e)).length,i=!1;++n<o;){var a=Se(t[n]);if(!(i=null!=e&&r(e,a)))break;e=e[a]}return i||++n!=o?i:!!(o=null==e?0:e.length)&&ze(o)&&Le(a,o)&&(l(e)||De(e))}(e,t,Nn)}var Fn=1,Rn=2;function Ln(e){return I(e)?It(Se(e)):function(e){return function(t){return Oe(t,e)}}(e)}function Wn(e){return"function"==typeof e?e:null==e?lt:"object"==typeof e?l(e)?function(e,t){return I(e)&&Dn(t)?Cn(Se(e),t):function(r){var n=xe(r,e);return void 0===n&&n===t?Bn(r,e):Mn(t,n,Fn|Rn)}}(e[0],e[1]):Un(e):Ln(e)}function zn(e,t){var r=-1,n=at(e)?Array(e.length):[];return ct(e,(function(e,o,i){n[++r]=t(e,o,i)})),n}function Hn(e,t){return(l(e)?ge:zn)(e,Wn(t))}var Gn=function(){try{var e=q(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),Yn=Gn;function Vn(e,t,r){"__proto__"==t&&Yn?Yn(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}var qn=Object.prototype.hasOwnProperty;function Zn(e,t,r){var n=e[t];qn.call(e,t)&&K(n,r)&&(void 0!==r||t in e)||Vn(e,t,r)}function Jn(e,t,r,n){var o=!r;r||(r={});for(var i=-1,a=t.length;++i<a;){var s=t[i],u=n?n(r[s],e[s],s,r,e):void 0;void 0===u&&(u=e[s]),o?Vn(r,s,u):Zn(r,s,u)}return r}var Xn=Object.prototype.hasOwnProperty;function Qn(e){if(!$(e))return function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}(e);var t=tt(e),r=[];for(var n in e)("constructor"!=n||!t&&Xn.call(e,n))&&r.push(n);return r}function Kn(e){return at(e)?Ke(e,!0):Qn(e)}var eo="object"==typeof exports&&exports&&!exports.nodeType&&exports,to=eo&&"object"==typeof module&&module&&!module.nodeType&&module,ro=to&&to.exports===eo?p.Buffer:void 0,no=ro?ro.allocUnsafe:void 0;function oo(e,t){if(t)return e.slice();var r=e.length,n=no?no(r):new e.constructor(r);return e.copy(n),n}function io(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t}var ao=rt(Object.getPrototypeOf,Object),so=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)gn(t,jn(e)),e=ao(e);return t}:mn,uo=so;function co(e){return vn(e,Kn,uo)}var lo=Object.prototype.hasOwnProperty;function fo(e){var t=new e.constructor(e.byteLength);return new Jr(t).set(new Jr(e)),t}var po=/\w*$/;var ho=h?h.prototype:void 0,go=ho?ho.valueOf:void 0;function vo(e,t){var r=t?fo(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}var yo="[object Boolean]",mo="[object Date]",bo="[object Map]",wo="[object Number]",jo="[object RegExp]",ko="[object Set]",So="[object String]",Oo="[object Symbol]",xo="[object ArrayBuffer]",_o="[object DataView]",Ao="[object Float32Array]",To="[object Float64Array]",Io="[object Int8Array]",$o="[object Int16Array]",Mo="[object Int32Array]",Eo="[object Uint8Array]",Po="[object Uint8ClampedArray]",Do="[object Uint16Array]",Co="[object Uint32Array]";function Uo(e,t,r){var n,o=e.constructor;switch(t){case xo:return fo(e);case yo:case mo:return new o(+e);case _o:return function(e,t){var r=t?fo(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}(e,r);case Ao:case To:case Io:case $o:case Mo:case Eo:case Po:case Do:case Co:return vo(e,r);case bo:return new o;case wo:case So:return new o(e);case jo:return function(e){var t=new e.constructor(e.source,po.exec(e));return t.lastIndex=e.lastIndex,t}(e);case ko:return new o;case Oo:return n=e,go?Object(go.call(n)):{}}}var No=Object.create,Bo=function(){function e(){}return function(t){if(!$(t))return{};if(No)return No(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}(),Fo=Bo;function Ro(e){return"function"!=typeof e.constructor||tt(e)?{}:Fo(ao(e))}var Lo=Ze&&Ze.isMap,Wo=Lo?Ge(Lo):function(e){return O(e)&&"[object Map]"==At(e)};var zo=Ze&&Ze.isSet,Ho=zo?Ge(zo):function(e){return O(e)&&"[object Set]"==At(e)},Go=1,Yo=2,Vo=4,qo="[object Arguments]",Zo="[object Function]",Jo="[object GeneratorFunction]",Xo="[object Object]",Qo={};function Ko(e,t,r,n,o,i){var a,s=t&Go,u=t&Yo,c=t&Vo;if(r&&(a=o?r(e,n,o,i):r(e)),void 0!==a)return a;if(!$(e))return e;var f=l(e);if(f){if(a=function(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&lo.call(e,"index")&&(r.index=e.index,r.input=e.input),r}(e),!s)return io(e,a)}else{var d=At(e),p=d==Zo||d==Jo;if(Be(e))return oo(e,s);if(d==Xo||d==qo||p&&!o){if(a=u||p?{}:Ro(e),!s)return u?function(e,t){return Jn(e,uo(e),t)}(e,function(e,t){return e&&Jn(t,Kn(t),e)}(a,e)):function(e,t){return Jn(e,jn(e),t)}(e,function(e,t){return e&&Jn(t,st(t),e)}(a,e))}else{if(!Qo[d])return o?e:{};a=Uo(e,d,s)}}i||(i=new zr);var h=i.get(e);if(h)return h;i.set(e,a),Ho(e)?e.forEach((function(n){a.add(Ko(n,t,r,n,e,i))})):Wo(e)&&e.forEach((function(n,o){a.set(o,Ko(n,t,r,o,e,i))}));var g=f?void 0:(c?u?co:kn:u?Kn:st)(e);return _e(g||e,(function(n,o){g&&(n=e[o=n]),Zn(a,o,Ko(n,t,r,o,e,i))})),a}Qo[qo]=Qo["[object Array]"]=Qo["[object ArrayBuffer]"]=Qo["[object DataView]"]=Qo["[object Boolean]"]=Qo["[object Date]"]=Qo["[object Float32Array]"]=Qo["[object Float64Array]"]=Qo["[object Int8Array]"]=Qo["[object Int16Array]"]=Qo["[object Int32Array]"]=Qo["[object Map]"]=Qo["[object Number]"]=Qo[Xo]=Qo["[object RegExp]"]=Qo["[object Set]"]=Qo["[object String]"]=Qo["[object Symbol]"]=Qo["[object Uint8Array]"]=Qo["[object Uint8ClampedArray]"]=Qo["[object Uint16Array]"]=Qo["[object Uint32Array]"]=!0,Qo["[object Error]"]=Qo[Zo]=Qo["[object WeakMap]"]=!1;var ei=1,ti=4;function ri(e){return Ko(e,ei|ti)}function ni(e,t){return!!Zt(e)&&(!(!Qt(t)&&!pr(t))&&t in e)}function oi(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Wr(),r={},n=null,o=xe(e,"timeAlive");jr(o)||(o=1e4),o=wr(o);let i=xe(e,"timeDetect");return jr(i)||(i=50),i=wr(i),t.trigger=function(e,a){Qt(e)?(ni(r,e)||setTimeout((()=>{t.emit("message",{eventName:"enter",key:e,data:a,now:qt(r)})}),1),r[e]={data:a,time:Date.now()},null===n&&(n=setInterval((()=>{ft(r,((e,n)=>{if(Date.now()-e.time>o){let e=ri(r[n]);delete r[n],t.emit("message",{eventName:"leave",key:n,data:e.data,now:qt(r)})}})),Jt(r)||(clearInterval(n),n=null)}),i))):console.log("trigger need key")},t.get=function(){let e=[];return ft(r,((t,r)=>{e.push({key:r,data:t.data})})),e=ri(e),e},t}function ii(e){return"[object ArrayBuffer]"===Object.prototype.toString.call(e)}function ai(e){return"[object Uint8Array]"===Object.prototype.toString.call(e)}function si(e){return"[object Uint16Array]"===Object.prototype.toString.call(e)}function ui(e){if(!(ii(e)||(t=e,"[object Blob]"===Object.prototype.toString.call(t))||ai(e)||si(e)))return null;var t;try{if(e.byteLength)return e.byteLength}catch(e){}try{if(e.length)return e.length}catch(e){}try{if(e.size)return e.size}catch(e){}return null}var ci="[object Object]",li=Function.prototype,fi=Object.prototype,di=li.toString,pi=fi.hasOwnProperty,hi=di.call(Object);function gi(e){if(!O(e)||S(e)!=ci)return!1;var t=ao(e);if(null===t)return!0;var r=pi.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&di.call(r)==hi}var vi="[object DOMException]",yi="[object Error]";function mi(e){if(!Zt(e))return{results:"",binarys:[]};if(Or(e))return{results:"",binarys:[]};let t="",r=[];try{let n=-1;t=JSON.stringify(e,(function(e,t){if(ai(t)){n+=1;let e=`[Uint8Array]::${n}`;return r.push(t),e}if(si(t)){n+=1;let e=`[Uint16Array]::${n}`;return r.push(t),e}if(ii(t)){n+=1;let e=`[ArrayBuffer]::${n}`;return r.push(t),e}return function(e){if(!O(e))return!1;var t=S(e);return t==yi||t==vi||"string"==typeof e.message&&"string"==typeof e.name&&!gi(e)}(t)&&(t=t.toString()),t}))}catch(e){}return{results:t,binarys:r}}var bi={exports:{}};var wi,ji={exports:{}};function ki(){return wi||(wi=1,function(e,t){var r;e.exports=(r=r||function(e,t){var r;if("undefined"!=typeof window&&window.crypto&&(r=window.crypto),"undefined"!=typeof self&&self.crypto&&(r=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(r=globalThis.crypto),!r&&"undefined"!=typeof window&&window.msCrypto&&(r=window.msCrypto),!r&&void 0!==a&&a.crypto&&(r=a.crypto),!r)try{r=require("crypto")}catch(e){}var n=function(){if(r){if("function"==typeof r.getRandomValues)try{return r.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof r.randomBytes)try{return r.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},o=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),i={},s=i.lib={},u=s.Base={extend:function(e){var t=o(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},c=s.WordArray=u.extend({init:function(e,r){e=this.words=e||[],this.sigBytes=r!=t?r:4*e.length},toString:function(e){return(e||f).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes,o=e.sigBytes;if(this.clamp(),n%4)for(var i=0;i<o;i++){var a=r[i>>>2]>>>24-i%4*8&255;t[n+i>>>2]|=a<<24-(n+i)%4*8}else for(var s=0;s<o;s+=4)t[n+s>>>2]=r[s>>>2];return this.sigBytes+=o,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=u.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],r=0;r<e;r+=4)t.push(n());return new c.init(t,e)}}),l=i.enc={},f=l.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],o=0;o<r;o++){var i=t[o>>>2]>>>24-o%4*8&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new c.init(r,t/2)}},d=l.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],o=0;o<r;o++){var i=t[o>>>2]>>>24-o%4*8&255;n.push(String.fromCharCode(i))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new c.init(r,t)}},p=l.Utf8={stringify:function(e){try{return decodeURIComponent(escape(d.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return d.parse(unescape(encodeURIComponent(e)))}},h=s.BufferedBlockAlgorithm=u.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=p.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r,n=this._data,o=n.words,i=n.sigBytes,a=this.blockSize,s=i/(4*a),u=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*a,l=e.min(4*u,i);if(u){for(var f=0;f<u;f+=a)this._doProcessBlock(o,f);r=o.splice(0,u),n.sigBytes-=l}return new c.init(r,l)},clone:function(){var e=u.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});s.Hasher=h.extend({cfg:u.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){h.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new g.HMAC.init(e,r).finalize(t)}}});var g=i.algo={};return i}(Math),r)}(ji)),ji.exports}!function(e,t){e.exports=ki().enc.Utf8}(bi);var Si=s(bi.exports),Oi={exports:{}};!function(e,t){var r;e.exports=(r=ki(),function(){var e=r,t=e.lib.WordArray;function n(e,r,n){for(var o=[],i=0,a=0;a<r;a++)if(a%4){var s=n[e.charCodeAt(a-1)]<<a%4*2|n[e.charCodeAt(a)]>>>6-a%4*2;o[i>>>2]|=s<<24-i%4*8,i++}return t.create(o,i)}e.enc.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,n=this._map;e.clamp();for(var o=[],i=0;i<r;i+=3)for(var a=(t[i>>>2]>>>24-i%4*8&255)<<16|(t[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|t[i+2>>>2]>>>24-(i+2)%4*8&255,s=0;s<4&&i+.75*s<r;s++)o.push(n.charAt(a>>>6*(3-s)&63));var u=n.charAt(64);if(u)for(;o.length%4;)o.push(u);return o.join("")},parse:function(e){var t=e.length,r=this._map,o=this._reverseMap;if(!o){o=this._reverseMap=[];for(var i=0;i<r.length;i++)o[r.charCodeAt(i)]=i}var a=r.charAt(64);if(a){var s=e.indexOf(a);-1!==s&&(t=s)}return n(e,t,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),r.enc.Base64)}(Oi);var xi=s(Oi.exports);function _i(e){if(!Qt(e))return new Uint8Array;let t;try{t=function(e){if(!Xt(e))return new Uint8Array;let t=xi.parse(e),r=t.words,n=t.sigBytes,o=new Uint8Array(n);for(let e=0;e<n;e++){let t=r[e>>>2]>>>24-e%4*8&255;o[e]=t}return o}(function(e){if(!Qt(e))return"";let t=Si.parse(e);return xi.stringify(t)}(e))}catch(e){return new Uint8Array}return t}function Ai(e,t){return function(e,t,r,n,o,i){if(!pr(e))return null;if(!ai(t))return null;if(!gr(r))return null;if(!Fr(n))return null;if(!gr(o))return null;if(!gr(i))return null;let a,s,u;e=hr(e);let c=8*i-o-1,l=(1<<c)-1,f=l>>1,d=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?i-1:0,h=n?-1:1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=l):(a=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-a))<1&&(a--,u*=2),(e+=a+f>=1?d/u:d*Math.pow(2,1-f))*u>=2&&(a++,u/=2),a+f>=l?(s=0,a=l):a+f>=1?(s=(e*u-1)*Math.pow(2,o),a+=f):(s=e*Math.pow(2,f-1)*Math.pow(2,o),a=0));o>=8;t[r+p]=255&s,p+=h,s/=256,o-=8);for(a=a<<o|s,c+=o;c>0;t[r+p]=255&a,p+=h,a/=256,c-=8);return t[r+p-h]|=128*g,null}(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,!(arguments.length>3&&void 0!==arguments[3])||arguments[3],arguments.length>4&&void 0!==arguments[4]?arguments[4]:52,arguments.length>5&&void 0!==arguments[5]?arguments[5]:8)}function Ti(e){let t=[],r=[];if(!_r(e)&&!Jt(e))return null;let n=[],o=[];function i(e){n.push(ui(e)),o.push(e)}try{let a=mi(e);i(_i(a.results)),ft(a.binarys,(e=>{i(e)}));let s=n,u=_i(JSON.stringify(s)),c=new Uint8Array(8);Ai(ui(u),c),t.push(c),t.push(u),ft(o,(e=>{t.push(e)})),ft(t,(e=>{r=function(e,t){let r=ui(e),n=ui(t),o=new Uint8Array(r+n);return o.set(new Uint8Array(e),0),o.set(new Uint8Array(t),r),o}(r,e)}))}catch(e){return null}return r}function Ii(e){return function(e,t,r,n,o){if(!ai(e))return null;if(!gr(t))return null;if(!Fr(r))return null;if(!gr(n))return null;if(!gr(o))return null;let i,a,s=8*o-n-1,u=(1<<s)-1,c=u>>1,l=-7,f=r?0:o-1,d=r?1:-1,p=e[t+f];for(f+=d,i=p&(1<<-l)-1,p>>=-l,l+=s;l>0;i=256*i+e[t+f],f+=d,l-=8);for(a=i&(1<<-l)-1,i>>=-l,l+=n;l>0;a=256*a+e[t+f],f+=d,l-=8);if(0===i)i=1-c;else{if(i===u)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,n),i-=c}return(p?-1:1)*a*Math.pow(2,i-n)}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,!(arguments.length>2&&void 0!==arguments[2])||arguments[2],arguments.length>3&&void 0!==arguments[3]?arguments[3]:52,arguments.length>4&&void 0!==arguments[4]?arguments[4]:8)}var $i={exports:{}};!function(e,t){var r;e.exports=(r=ki(),function(){if("function"==typeof ArrayBuffer){var e=r.lib.WordArray,t=e.init,n=e.init=function(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(e instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e instanceof Uint8Array){for(var r=e.byteLength,n=[],o=0;o<r;o++)n[o>>>2]|=e[o]<<24-o%4*8;t.call(this,n,r)}else t.apply(this,arguments)};n.prototype=e}}(),r.lib.WordArray)}($i);var Mi=s($i.exports);function Ei(e){if(!ai(e))return"";let t;try{r=function(e){return ai(e)?Mi.create(e).toString(xi):""}(e),t=Qt(r)?xi.parse(r).toString(Si):""}catch(e){return""}var r;return t}function Pi(e){let t=null;if(!ai(e))return null;try{let r=8,n=e.slice(0,r),o=e.slice(r,ui(e)),i=Ii(n),a=o.slice(0,i),s=o.slice(i,ui(o)),u=Ei(a),c=function(e,t){let r=0,n=0,o=[];return ft(t,(t=>{n=r+t;let i=e.slice(r,n);r=n,o.push(i)})),o}(s,JSON.parse(u));t=function(e){if(!Jt(e))return{};let{results:t,binarys:r}=e;if(!Qt(t))return{};if(!kr(r))return{};let n={};try{n=JSON.parse(t,(function(e,t){if(Qt(t)){if(t.indexOf("[Uint8Array]::")>=0){let e=wr(t.replace("[Uint8Array]::",""));return r[e]}if(t.indexOf("[Uint16Array]::")>=0){let e=wr(t.replace("[Uint16Array]::",""));return r[e]}if(t.indexOf("[ArrayBuffer]::")>=0){let e=wr(t.replace("[ArrayBuffer]::",""));return r[e]}}return t}))}catch(e){}return n}({results:Ei(c.shift()),binarys:c})}catch(e){}return t}function Di(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={};e.port||(e.port=8080),e.apiName||(e.apiName="api");let a,s=new o.EventEmitter,u=oi();function c(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];setTimeout((()=>{s.emit(e,...r)}),1)}async function l(e){let r=Er(),n=Er(),o=xe(e,"_mode","");if(n.then((t=>{e.output=t,delete e.input,r.resolve(e)})).catch((e=>{r.reject(e)})),"execute"===o){c("execute",xe(e,"func",""),xe(e,"input",null),n)}else if("broadcast"===o){c("broadcast",xe(e,"input",null)),n.resolve("ok")}else if("deliver"===o){c("deliver",xe(e,"input",null)),n.resolve("ok")}else if("polling"===o){let r=xe(e,"clientId",""),o=xe(t,r,[]);o=ri(o),t[r]=[],n.resolve(o)}else{let t="can not find _mode in data";!function(e,t){c("error",{msg:e,err:t})}(t,e),r.reject(t),n.reject()}return r}setInterval((()=>{let e=Hn(u.get(),"key"),r={};ft(e,(e=>{r[e]=xe(t,e,[])})),t=r}),1e3),a=e.serverHapi?e.serverHapi:r.server({port:e.port,routes:{cors:{origin:["*"]}}}),c("open"),u.on("message",(function(e){let{eventName:t,key:r,data:n,now:o}=e;"enter"===t?c("clientEnter",r,n):"leave"===t&&c("clientLeave",r,n),c("clientChange",o)}));let f={path:"/"+e.apiName,method:"POST",options:{payload:{maxBytes:1073741824,timeout:18e4,multipart:!0},timeout:{socket:3e5}},handler:async function(e,t){let r=xe(e,"headers");r=Jt(r)?r:"";let n=xe(e,"query");n=Jt(n)?n:"",c("handler",{headers:r,query:n});let o=xe(e,"payload.bb",null);Xt(o)&&(o=Buffer.from(o,"utf8"));let a=Pi(new Uint8Array(o)),s=xe(a,"clientId"),f={headers:e.headers,info:e.info};u.trigger(s,f);let d={};await l(a).then((function(e){d.success=e})).catch((function(e){d.error=e}));let p=Ti(d),h=new i.Readable;return h._read=()=>{},h.push(p),h.push(null),t.response(h).header("Cache-Control","no-cache, no-store, must-revalidate").header("Content-Type","application/octet-stream").header("Content-Length",h.readableLength)}};return s.broadcast=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};if(xr(t))return;let n={};ft(t,((t,r)=>{t.push({mode:"broadcast",data:e}),n[r]=t})),t=n,r(100)},s.deliver=function(e,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},o=xe(t,e,[]);o.push({mode:"deliver",data:r}),t[e]=o,n(100)},e.serverHapi?e.serverHapi.route(f):async function(){await a.register(n),a.route([{method:"GET",path:"/{file*}",handler:{directory:{path:"./"}}},f]),await a.start(),console.log(`Server running at: ${a.info.uri}`)}(),s}let Ci="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),Ui=Ci.length;function Ni(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32,t=[];e=jr(e)?wr(e):32;for(let r=0;r<e;r++)t[r]=Ci[0|Math.random()*Ui];return t.join("")}var Bi=function(){return p.Date.now()},Fi="Expected a function",Ri=Math.max,Li=Math.min;function Wi(e,t,r){var n,o,i,a,s,u,c=0,l=!1,f=!1,d=!0;if("function"!=typeof e)throw new TypeError(Fi);function p(t){var r=n,i=o;return n=o=void 0,c=t,a=e.apply(i,r)}function h(e){var r=e-u;return void 0===u||r>=t||r<0||f&&e-c>=i}function g(){var e=Bi();if(h(e))return v(e);s=setTimeout(g,function(e){var r=t-(e-u);return f?Li(r,i-(e-c)):r}(e))}function v(e){return s=void 0,d&&n?p(e):(n=o=void 0,a)}function y(){var e=Bi(),r=h(e);if(n=arguments,o=this,u=e,r){if(void 0===s)return function(e){return c=e,s=setTimeout(g,t),l?p(e):a}(u);if(f)return clearTimeout(s),s=setTimeout(g,t),p(u)}return void 0===s&&(s=setTimeout(g,t)),a}return t=sr(t)||0,$(r)&&(l=!!r.leading,i=(f="maxWait"in r)?Ri(sr(r.maxWait)||0,t):i,d="trailing"in r?!!r.trailing:d),y.cancel=function(){void 0!==s&&clearTimeout(s),c=0,n=u=o=s=void 0},y.flush=function(){return void 0===s?a:v(Bi())},y}function zi(e,t,r){(void 0!==r&&!K(e[t],r)||void 0===r&&!(t in e))&&Vn(e,t,r)}function Hi(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}function Gi(e,t,r,n,o,i,a){var s=Hi(e,r),u=Hi(t,r),c=a.get(u);if(c)zi(e,r,c);else{var f,d=i?i(s,u,r+"",e,t,a):void 0,p=void 0===d;if(p){var h=l(u),g=!h&&Be(u),v=!h&&!g&&Xe(u);d=u,h||g||v?l(s)?d=s:O(f=s)&&at(f)?d=io(s):g?(p=!1,d=oo(u,!0)):v?(p=!1,d=vo(u,!0)):d=[]:gi(u)||De(u)?(d=s,De(s)?d=function(e){return Jn(e,Kn(e))}(s):$(s)&&!C(s)||(d=Ro(u))):p=!1}p&&(a.set(u,d),o(d,u,n,i,a),a.delete(u)),zi(e,r,d)}}function Yi(e,t,r,n,o){e!==t&&Te(t,(function(i,a){if(o||(o=new zr),$(i))Gi(e,t,a,r,Yi,n,o);else{var s=n?n(Hi(e,a),i,a+"",e,t,o):void 0;void 0===s&&(s=i),zi(e,a,s)}}),Kn)}var Vi=Math.max;var qi=Yn?function(e,t){return Yn(e,"toString",{configurable:!0,enumerable:!1,value:(r=t,function(){return r}),writable:!0});var r}:lt,Zi=qi,Ji=Date.now;var Xi=function(e){var t=0,r=0;return function(){var n=Ji(),o=16-(n-r);if(r=n,o>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(Zi),Qi=Xi;function Ki(e,t){return Qi(function(e,t,r){return t=Vi(void 0===t?e.length-1:t,0),function(){for(var n=arguments,o=-1,i=Vi(n.length-t,0),a=Array(i);++o<i;)a[o]=n[t+o];o=-1;for(var s=Array(t+1);++o<t;)s[o]=n[o];return s[t]=r(a),function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}(e,this,s)}}(e,t,lt),e+"")}var ea,ta=(ea=function(e,t,r){Yi(e,t,r)},Ki((function(e,t){var r=-1,n=t.length,o=n>1?t[n-1]:void 0,i=n>2?t[2]:void 0;for(o=ea.length>3&&"function"==typeof o?(n--,o):void 0,i&&function(e,t,r){if(!$(r))return!1;var n=typeof t;return!!("number"==n?at(r)&&Le(t,r.length):"string"==n&&t in r)&&K(r[t],e)}(t[0],t[1],i)&&(o=n<3?void 0:o,n=1),e=Object(e);++r<n;){var a=t[r];a&&ea(e,a,r,o)}return e})));let ra=e.resolve();function na(){let e={},r=xe(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"fnTableTags");Qt(r)||(r="tableTags.json"),r=`${ra}/${r}`;let n=Wr();function o(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];setTimeout((()=>{n.emit(e,...r)}),1)}function i(){let e={};try{if(t.existsSync(r)){let n=Ir(t.readFileSync(r,"utf8"));Jt(n)&&(e=n)}}catch(e){o("error",{msg:"readTableTags catch",err:e})}return e}function a(){try{let n=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Sr(e))return"";let r="";try{r=t?JSON.stringify(e,null,2):JSON.stringify(e)}catch(e){r=""}return r}(e);t.writeFileSync(r,n,"utf8")}catch(e){o("error",{msg:"writeTableTags catch",err:e})}}let s=Wi((()=>{a(),o("changeTableTags",e)}),200);return n.readTableTags=i,n.writeTableTags=a,n.initTableTags=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"useInputFirst";e="useStorageFirst"===r?ta(t,i()):"useInputOnly"===r?t:"useStorageOnly"===r?i():ta(i(),t),a()},n.setTableTags=function(){e=ta(e,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),a()},n.getTableTags=function(){return e},n.updateTableTag=function(t){e[t]=function(){if(!Ar(c))throw new Error("invalid dayjs");return c().format("YYYY-MM-DDTHH:mm:ssZ")}()+"|"+Ni(6),s()},n}function oa(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Wr(),r=xe(e,"instWConverServer",null);if(null===r)return t.emit("error","invalid opt.instWConverServer"),t;let n=xe(e,"dbORMs",null);if(!Zt(n))return t.emit("error","invalid opt.dbORMs"),t;let o=xe(e,"tableNames",null);if(!kr(o))return t.emit("error","invalid opt.tableNames"),t;0===qt(o)&&console.log("opt.tableNames.lenght = 0");let i=xe(e,"fnTableTags",null);Qt(i)||(i="tableTags.json");let a=new na({fnTableTags:i});o=ri(o);let s={};function u(e){let t={};return ft(o,(r=>{let n=r,o=e[r];t[n]=o})),t}return ft(o,(e=>{s[e]=Ni(6)})),a.initTableTags(s,"useInputOnly"),ft(o,(e=>{let t=n[e];if(!t)throw new Error(`invalid dbORMs.${e}`);t.on("change",(()=>{a.updateTableTag(e)}))})),r.on("clientEnter",(function(e,t){r.deliver(e,{mode:"syncTable",data:a.readTableTags()})})),a.on("changeTableTags",(e=>{r.broadcast({mode:"syncTable",data:u(e)})})),a}function ia(e){return ia="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ia(e)}function aa(e){var t=function(e,t){if("object"!=ia(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=ia(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==ia(t)?t:t+""}function sa(e,t,r){return(t=aa(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ua(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ca(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ua(Object(r),!0).forEach((function(t){sa(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ua(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}let la={},fa=null;async function da(e){let{func:t,input:r,pm:n}=e,o="";if(!ni(r,"__sysToken__"))return n.resolve({state:"error",msg:"invalid token"}),n;if(o=function(e){if(!Qt(e)&&!pr(e)&&!_(e))return"";let t="";try{t=String(e)}catch(e){}try{t=e.toString()}catch(e){}return t}(r.__sysToken__),!ni(r,"__sysInputArgs__"))return n.resolve({state:"error",msg:"invalid input"}),n;r=r.__sysInputArgs__;let i="",a=fa(o);if(i=Tr(a)?await a:a,Qt(i)||(i=""),"getFuncList"===t){let e={state:"success",msg:st(la)};return n.resolve(e),n}if(!ni(la,t))return n.resolve({state:"error",msg:`invalid func[${t}]`}),n;let s=la[t];try{let e=await Pr(s)(i,...r);n.resolve(e)}catch(e){n.resolve({state:"error",msg:`無法識別func: ${t}`})}return n}function pa(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Wr(),r=xe(e,"instWConverServer",null);if(null===r)return t.emit("error","invalid opt.instWConverServer"),t;fa=xe(e,"cbGetUserIDFromToken",null),Ar(fa)||(fa=async()=>"");let n=xe(e,"useDbORM",null);Fr(n)||(n=!0);let o=null;if(n&&(o=xe(e,"operORM",null),!Ar(o)))return t.emit("error","invalid opt.operORM when useDbORM=true"),t;let i=[];if(n&&(i=xe(e,"tableNames",null),!kr(i)))return t.emit("error","invalid opt.tableNames when useDbORM=true"),t;let a=[];n&&(a=xe(e,"methods",null),kr(a)||(a=["select","insert","save","del"]));let s=xe(e,"extFuncs",null),u=xe(e,"hookBefores",null),c=xe(e,"hookAfters",null),l={};return n&&(i=ri(i),l=function(e,t,r){let n={};return ft(e,(e=>{ft(t,(t=>{n[`${e}.${t}`]=async function(n,o){return await r(n,e,t,o)}}))})),n}(i,a,o)),Zt(s)&&ft(s,((e,t)=>{l[t]=e})),la=l,r.on("execute",(async function(e,r,n){let o={func:e,input:r,pm:n};if(Ar(u))try{u(o)}catch(e){t.emit("error",e)}else _r(u)&&ft(u,(e=>{if(Ar(e))try{e(o)}catch(e){t.emit("error",e)}}));let i=await da(o).catch((e=>{t.emit("error",e)})),a=ca(ca({},o),{},{output:i});if(Ar(c))try{c(a)}catch(e){t.emit("error",e)}else _r(c)&&ft(c,(e=>{if(Ar(e))try{e(a)}catch(e){t.emit("error",e)}}))})),t}function ha(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=null,r=null,n=Wr(),o=xe(e,"instWConverServer",null);if(null===o)return n.emit("error","invalid opt.instWConverServer"),n;let i=xe(e,"useDbORM",null);Fr(i)||(i=!0);let a=xe(e,"dbORMs",null),s=xe(e,"operORM",null),u=xe(e,"tableNamesExec",null),c=xe(e,"methodsExec",null),l=xe(e,"tableNamesSync",null),f=xe(e,"cbGetUserIDFromToken",null),d=xe(e,"extFuncs",null),p=xe(e,"hookBefores",null),h=xe(e,"hookAfters",null),g=xe(e,"fnTableTags",null);if(t=new pa({instWConverServer:o,cbGetUserIDFromToken:f,useDbORM:i,operORM:s,tableNames:u,methods:c,extFuncs:d,hookBefores:p,hookAfters:h}),t.on("error",(e=>{n.emit("error",e)})),i){if(!Zt(a))return n.emit("error","invalid opt.dbORMs when useDbORM=true"),n;r=new oa({instWConverServer:o,dbORMs:a,tableNames:l,fnTableTags:g}),r.on("error",(e=>{n.emit("error",e)}))}return n.getInstWServWebdataServerExec=()=>t,n.getInstWServWebdataServerSync=()=>r,n}function ga(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=null,o=null,i=null,a=Wr(),s=xe(e,"port");gr(s)||(s=8080);let u=xe(e,"useCors");Fr(u)||(u=!0);let c=xe(e,"useInert");Fr(c)||(c=!0);let l=xe(e,"pathStaticFiles");Qt(l)||(l="dist");let f=xe(e,"apis");_r(f)||(f=[]);let d=xe(e,"getUserIDFromToken",null),p=xe(e,"useDbORM",null);Fr(p)||(p=!0);let h=xe(e,"dbORMs",null),g=xe(e,"operORM",null),v=xe(e,"tableNamesExec",null),y=xe(e,"methodsExec",null),m=xe(e,"tableNamesSync",null),b=xe(e,"extFuncs",null),w=xe(e,"hookBefores",null),j=xe(e,"hookAfters",null),k=xe(e,"fnTableTags",null),S=xe(e,"showLog");Fr(S)||(S=!0);return(async()=>{await(async()=>{t=new r.Server({port:s,routes:{cors:u}}),c&&await t.register(n);let e=[];c&&(e=[{method:"GET",path:"/{file*}",handler:{directory:{path:`${l}/`}}}]),e=[...e,...f],t.route(e)})(),await(async()=>{o=new Di({serverHapi:t}),o.on("open",(function(){S&&console.log(`Server[port:${s}]: open`)})),o.on("error",(function(e){S&&console.log(`Server[port:${s}]: error`,e),a.emit("error",{mode:"instWConverhpServer error",err:e})})),o.on("clientChange",(function(e){S&&console.log(`Server[port:${s}]: now clients: ${e}`)}))})(),await(async()=>{i=new ha({instWConverServer:o,cbGetUserIDFromToken:d,useDbORM:p,dbORMs:h,operORM:g,tableNamesExec:v,tableNamesSync:m,methodsExec:y,extFuncs:b,hookBefores:w,hookAfters:j,fnTableTags:k}),i.on("error",(e=>{S&&console.log("error",e),a.emit("error",{mode:"instWServWebdataServer error",err:e})}))})(),await t.start(),S&&console.log(`Server running at: ${t.info.uri}`)})(),process.on("unhandledRejection",(e=>{console.log("unhandledRejection",e),a.emit("error",{mode:"unhandledRejection",err:e})})),process.on("uncaughtException",(e=>{console.log("uncaughtException",e),a.emit("error",{mode:"uncaughtException",err:e})})),a.getServer=()=>t,a.getInstWConverhpServer=()=>o,a.getInstWServWebdataServer=()=>i,a}function va(e){return e!=e}function ya(e,t,r){return t==t?function(e,t,r){for(var n=r-1,o=e.length;++n<o;)if(e[n]===t)return n;return-1}(e,t,r):function(e,t,r,n){for(var o=e.length,i=r+(n?1:-1);n?i--:++i<o;)if(t(e[i],i,e))return i;return-1}(e,va,r)}var ma="\\ud800-\\udfff",ba="["+ma+"]",wa="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",ja="\\ud83c[\\udffb-\\udfff]",ka="[^"+ma+"]",Sa="(?:\\ud83c[\\udde6-\\uddff]){2}",Oa="[\\ud800-\\udbff][\\udc00-\\udfff]",xa="(?:"+wa+"|"+ja+")"+"?",_a="[\\ufe0e\\ufe0f]?",Aa=_a+xa+("(?:\\u200d(?:"+[ka,Sa,Oa].join("|")+")"+_a+xa+")*"),Ta="(?:"+[ka+wa+"?",wa,Sa,Oa,ba].join("|")+")",Ia=RegExp(ja+"(?="+ja+")|"+Ta+Aa,"g");function $a(e){return Et(e)?function(e){return e.match(Ia)||[]}(e):function(e){return e.split("")}(e)}function Ma(e,t,r){if((e=we(e))&&(r||void 0===t))return tr(e);if(!e||!(t=be(t)))return e;var n=$a(e),o=$a(t),i=function(e,t){for(var r=-1,n=e.length;++r<n&&ya(t,e[r],0)>-1;);return r}(n,o),a=function(e,t){for(var r=e.length;r--&&ya(t,e[r],0)>-1;);return r}(n,o)+1;return function(e,t,r){var n=e.length;return r=void 0===r?n:r,!t&&r>=n?e:Dr(e,t,r)}(n,i,a).join("")}let Ea={backup:async function(e){return await Cr(e,(async(e,t)=>(console.log("backup...",t),{name:t,data:await e.select()})))},recover:async function(e,r,n){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!Ur(e))throw console.log("fp",e),new Error("fp is not exist");if(!Jt(r))throw console.log("woItems",r),new Error("invalid woItems");Ar(n)||(n=null),Fr(o)||(o=!1);let i=t.readFileSync(e,"utf8");i=Ma(i);let a=Ir(i);Ar(n)&&n(),await Cr(a,(async e=>{console.log("recover...",e.name),o&&(console.log("needCreateStorage"),await r[e.name].createStorage());let t=null;return qt(e.data)>0&&(t=await r[e.name].insert(e.data)),t}))}};function Pa(){if(!Ar(c))throw new Error("invalid dayjs");return c().format("YYYY-MM-DDTHH:mm:ss.SSSZ")}var Da={exports:{}},Ca={},Ua={exports:{}},Na={};function Ba(){var e={"align-content":!1,"align-items":!1,"align-self":!1,"alignment-adjust":!1,"alignment-baseline":!1,all:!1,"anchor-point":!1,animation:!1,"animation-delay":!1,"animation-direction":!1,"animation-duration":!1,"animation-fill-mode":!1,"animation-iteration-count":!1,"animation-name":!1,"animation-play-state":!1,"animation-timing-function":!1,azimuth:!1,"backface-visibility":!1,background:!0,"background-attachment":!0,"background-clip":!0,"background-color":!0,"background-image":!0,"background-origin":!0,"background-position":!0,"background-repeat":!0,"background-size":!0,"baseline-shift":!1,binding:!1,bleed:!1,"bookmark-label":!1,"bookmark-level":!1,"bookmark-state":!1,border:!0,"border-bottom":!0,"border-bottom-color":!0,"border-bottom-left-radius":!0,"border-bottom-right-radius":!0,"border-bottom-style":!0,"border-bottom-width":!0,"border-collapse":!0,"border-color":!0,"border-image":!0,"border-image-outset":!0,"border-image-repeat":!0,"border-image-slice":!0,"border-image-source":!0,"border-image-width":!0,"border-left":!0,"border-left-color":!0,"border-left-style":!0,"border-left-width":!0,"border-radius":!0,"border-right":!0,"border-right-color":!0,"border-right-style":!0,"border-right-width":!0,"border-spacing":!0,"border-style":!0,"border-top":!0,"border-top-color":!0,"border-top-left-radius":!0,"border-top-right-radius":!0,"border-top-style":!0,"border-top-width":!0,"border-width":!0,bottom:!1,"box-decoration-break":!0,"box-shadow":!0,"box-sizing":!0,"box-snap":!0,"box-suppress":!0,"break-after":!0,"break-before":!0,"break-inside":!0,"caption-side":!1,chains:!1,clear:!0,clip:!1,"clip-path":!1,"clip-rule":!1,color:!0,"color-interpolation-filters":!0,"column-count":!1,"column-fill":!1,"column-gap":!1,"column-rule":!1,"column-rule-color":!1,"column-rule-style":!1,"column-rule-width":!1,"column-span":!1,"column-width":!1,columns:!1,contain:!1,content:!1,"counter-increment":!1,"counter-reset":!1,"counter-set":!1,crop:!1,cue:!1,"cue-after":!1,"cue-before":!1,cursor:!1,direction:!1,display:!0,"display-inside":!0,"display-list":!0,"display-outside":!0,"dominant-baseline":!1,elevation:!1,"empty-cells":!1,filter:!1,flex:!1,"flex-basis":!1,"flex-direction":!1,"flex-flow":!1,"flex-grow":!1,"flex-shrink":!1,"flex-wrap":!1,float:!1,"float-offset":!1,"flood-color":!1,"flood-opacity":!1,"flow-from":!1,"flow-into":!1,font:!0,"font-family":!0,"font-feature-settings":!0,"font-kerning":!0,"font-language-override":!0,"font-size":!0,"font-size-adjust":!0,"font-stretch":!0,"font-style":!0,"font-synthesis":!0,"font-variant":!0,"font-variant-alternates":!0,"font-variant-caps":!0,"font-variant-east-asian":!0,"font-variant-ligatures":!0,"font-variant-numeric":!0,"font-variant-position":!0,"font-weight":!0,grid:!1,"grid-area":!1,"grid-auto-columns":!1,"grid-auto-flow":!1,"grid-auto-rows":!1,"grid-column":!1,"grid-column-end":!1,"grid-column-start":!1,"grid-row":!1,"grid-row-end":!1,"grid-row-start":!1,"grid-template":!1,"grid-template-areas":!1,"grid-template-columns":!1,"grid-template-rows":!1,"hanging-punctuation":!1,height:!0,hyphens:!1,icon:!1,"image-orientation":!1,"image-resolution":!1,"ime-mode":!1,"initial-letters":!1,"inline-box-align":!1,"justify-content":!1,"justify-items":!1,"justify-self":!1,left:!1,"letter-spacing":!0,"lighting-color":!0,"line-box-contain":!1,"line-break":!1,"line-grid":!1,"line-height":!1,"line-snap":!1,"line-stacking":!1,"line-stacking-ruby":!1,"line-stacking-shift":!1,"line-stacking-strategy":!1,"list-style":!0,"list-style-image":!0,"list-style-position":!0,"list-style-type":!0,margin:!0,"margin-bottom":!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"marker-offset":!1,"marker-side":!1,marks:!1,mask:!1,"mask-box":!1,"mask-box-outset":!1,"mask-box-repeat":!1,"mask-box-slice":!1,"mask-box-source":!1,"mask-box-width":!1,"mask-clip":!1,"mask-image":!1,"mask-origin":!1,"mask-position":!1,"mask-repeat":!1,"mask-size":!1,"mask-source-type":!1,"mask-type":!1,"max-height":!0,"max-lines":!1,"max-width":!0,"min-height":!0,"min-width":!0,"move-to":!1,"nav-down":!1,"nav-index":!1,"nav-left":!1,"nav-right":!1,"nav-up":!1,"object-fit":!1,"object-position":!1,opacity:!1,order:!1,orphans:!1,outline:!1,"outline-color":!1,"outline-offset":!1,"outline-style":!1,"outline-width":!1,overflow:!1,"overflow-wrap":!1,"overflow-x":!1,"overflow-y":!1,padding:!0,"padding-bottom":!0,"padding-left":!0,"padding-right":!0,"padding-top":!0,page:!1,"page-break-after":!1,"page-break-before":!1,"page-break-inside":!1,"page-policy":!1,pause:!1,"pause-after":!1,"pause-before":!1,perspective:!1,"perspective-origin":!1,pitch:!1,"pitch-range":!1,"play-during":!1,position:!1,"presentation-level":!1,quotes:!1,"region-fragment":!1,resize:!1,rest:!1,"rest-after":!1,"rest-before":!1,richness:!1,right:!1,rotation:!1,"rotation-point":!1,"ruby-align":!1,"ruby-merge":!1,"ruby-position":!1,"shape-image-threshold":!1,"shape-outside":!1,"shape-margin":!1,size:!1,speak:!1,"speak-as":!1,"speak-header":!1,"speak-numeral":!1,"speak-punctuation":!1,"speech-rate":!1,stress:!1,"string-set":!1,"tab-size":!1,"table-layout":!1,"text-align":!0,"text-align-last":!0,"text-combine-upright":!0,"text-decoration":!0,"text-decoration-color":!0,"text-decoration-line":!0,"text-decoration-skip":!0,"text-decoration-style":!0,"text-emphasis":!0,"text-emphasis-color":!0,"text-emphasis-position":!0,"text-emphasis-style":!0,"text-height":!0,"text-indent":!0,"text-justify":!0,"text-orientation":!0,"text-overflow":!0,"text-shadow":!0,"text-space-collapse":!0,"text-transform":!0,"text-underline-position":!0,"text-wrap":!0,top:!1,transform:!1,"transform-origin":!1,"transform-style":!1,transition:!1,"transition-delay":!1,"transition-duration":!1,"transition-property":!1,"transition-timing-function":!1,"unicode-bidi":!1,"vertical-align":!1,visibility:!1,"voice-balance":!1,"voice-duration":!1,"voice-family":!1,"voice-pitch":!1,"voice-range":!1,"voice-rate":!1,"voice-stress":!1,"voice-volume":!1,volume:!1,"white-space":!1,widows:!1,width:!0,"will-change":!1,"word-break":!0,"word-spacing":!0,"word-wrap":!0,"wrap-flow":!1,"wrap-through":!1,"writing-mode":!1,"z-index":!1};return e}var Fa=/javascript\s*\:/gim;Na.whiteList=Ba(),Na.getDefaultWhiteList=Ba,Na.onAttr=function(e,t,r){},Na.onIgnoreAttr=function(e,t,r){},Na.safeAttrValue=function(e,t){return Fa.test(t)?"":t};var Ra={indexOf:function(e,t){var r,n;if(Array.prototype.indexOf)return e.indexOf(t);for(r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1},forEach:function(e,t,r){var n,o;if(Array.prototype.forEach)return e.forEach(t,r);for(n=0,o=e.length;n<o;n++)t.call(r,e[n],n,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(e){return String.prototype.trimRight?e.trimRight():e.replace(/(\s*$)/g,"")}};var La=function(e,t){";"!==(e=Ra.trimRight(e))[e.length-1]&&(e+=";");var r=e.length,n=!1,o=0,i=0,a="";function s(){if(!n){var r=Ra.trim(e.slice(o,i)),s=r.indexOf(":");if(-1!==s){var u=Ra.trim(r.slice(0,s)),c=Ra.trim(r.slice(s+1));if(u){var l=t(o,a.length,u,c,r);l&&(a+=l+"; ")}}}o=i+1}for(;i<r;i++){var u=e[i];if("/"===u&&"*"===e[i+1]){var c=e.indexOf("*/",i+2);if(-1===c)break;o=(i=c+1)+1,n=!1}else"("===u?n=!0:")"===u?n=!1:";"===u?n||s():"\n"===u&&s()}return Ra.trim(a)},Wa=Na,za=La;function Ha(e){return null==e}function Ga(e){(e=function(e){var t={};for(var r in e)t[r]=e[r];return t}(e||{})).whiteList=e.whiteList||Wa.whiteList,e.onAttr=e.onAttr||Wa.onAttr,e.onIgnoreAttr=e.onIgnoreAttr||Wa.onIgnoreAttr,e.safeAttrValue=e.safeAttrValue||Wa.safeAttrValue,this.options=e}Ga.prototype.process=function(e){if(!(e=(e=e||"").toString()))return"";var t=this.options,r=t.whiteList,n=t.onAttr,o=t.onIgnoreAttr,i=t.safeAttrValue;return za(e,(function(e,t,a,s,u){var c=r[a],l=!1;if(!0===c?l=c:"function"==typeof c?l=c(s):c instanceof RegExp&&(l=c.test(s)),!0!==l&&(l=!1),s=i(a,s)){var f,d={position:t,sourcePosition:e,source:u,isWhite:l};return l?Ha(f=n(a,s,d))?a+":"+s:f:Ha(f=o(a,s,d))?void 0:f}}))};var Ya=Ga;!function(e,t){var r=Na,n=Ya;for(var o in(t=e.exports=function(e,t){return new n(t).process(e)}).FilterCSS=n,r)t[o]=r[o];"undefined"!=typeof window&&(window.filterCSS=e.exports)}(Ua,Ua.exports);var Va=Ua.exports,qa={indexOf:function(e,t){var r,n;if(Array.prototype.indexOf)return e.indexOf(t);for(r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1},forEach:function(e,t,r){var n,o;if(Array.prototype.forEach)return e.forEach(t,r);for(n=0,o=e.length;n<o;n++)t.call(r,e[n],n,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(e){var t=/\s|\n|\t/.exec(e);return t?t.index:-1}},Za=Va.FilterCSS,Ja=Va.getDefaultWhiteList,Xa=qa;function Qa(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height","loading"],ins:["datetime"],kbd:[],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var Ka=new Za;function es(e){return e.replace(ts,"&lt;").replace(rs,"&gt;")}var ts=/</g,rs=/>/g,ns=/"/g,os=/&quot;/g,is=/&#([a-zA-Z0-9]*);?/gim,as=/&colon;?/gim,ss=/&newline;?/gim,us=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,cs=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,ls=/u\s*r\s*l\s*\(.*/gi;function fs(e){return e.replace(ns,"&quot;")}function ds(e){return e.replace(os,'"')}function ps(e){return e.replace(is,(function(e,t){return"x"===t[0]||"X"===t[0]?String.fromCharCode(parseInt(t.substr(1),16)):String.fromCharCode(parseInt(t,10))}))}function hs(e){return e.replace(as,":").replace(ss," ")}function gs(e){for(var t="",r=0,n=e.length;r<n;r++)t+=e.charCodeAt(r)<32?" ":e.charAt(r);return Xa.trim(t)}function vs(e){return e=gs(e=hs(e=ps(e=ds(e))))}function ys(e){return e=es(e=fs(e))}Ca.whiteList={a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height","loading"],ins:["datetime"],kbd:[],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]},Ca.getDefaultWhiteList=Qa,Ca.onTag=function(e,t,r){},Ca.onIgnoreTag=function(e,t,r){},Ca.onTagAttr=function(e,t,r){},Ca.onIgnoreTagAttr=function(e,t,r){},Ca.safeAttrValue=function(e,t,r,n){if(r=vs(r),"href"===t||"src"===t){if("#"===(r=Xa.trim(r)))return"#";if("http://"!==r.substr(0,7)&&"https://"!==r.substr(0,8)&&"mailto:"!==r.substr(0,7)&&"tel:"!==r.substr(0,4)&&"data:image/"!==r.substr(0,11)&&"ftp://"!==r.substr(0,6)&&"./"!==r.substr(0,2)&&"../"!==r.substr(0,3)&&"#"!==r[0]&&"/"!==r[0])return""}else if("background"===t){if(us.lastIndex=0,us.test(r))return""}else if("style"===t){if(cs.lastIndex=0,cs.test(r))return"";if(ls.lastIndex=0,ls.test(r)&&(us.lastIndex=0,us.test(r)))return"";!1!==n&&(r=(n=n||Ka).process(r))}return r=ys(r)},Ca.escapeHtml=es,Ca.escapeQuote=fs,Ca.unescapeQuote=ds,Ca.escapeHtmlEntities=ps,Ca.escapeDangerHtml5Entities=hs,Ca.clearNonPrintableCharacter=gs,Ca.friendlyAttrValue=vs,Ca.escapeAttrValue=ys,Ca.onIgnoreTagStripAll=function(){return""},Ca.StripTagBody=function(e,t){"function"!=typeof t&&(t=function(){});var r=!Array.isArray(e),n=[],o=!1;return{onIgnoreTag:function(i,a,s){if(function(t){return!!r||-1!==Xa.indexOf(e,t)}(i)){if(s.isClosing){var u="[/removed]",c=s.position+10;return n.push([!1!==o?o:s.position,c]),o=!1,u}return o||(o=s.position),"[removed]"}return t(i,a,s)},remove:function(e){var t="",r=0;return Xa.forEach(n,(function(n){t+=e.slice(r,n[0]),r=n[1]})),t+=e.slice(r)}}},Ca.stripCommentTag=function(e){for(var t="",r=0;r<e.length;){var n=e.indexOf("\x3c!--",r);if(-1===n){t+=e.slice(r);break}t+=e.slice(r,n);var o=e.indexOf("--\x3e",n);if(-1===o)break;r=o+3}return t},Ca.stripBlankChar=function(e){var t=e.split("");return(t=t.filter((function(e){var t=e.charCodeAt(0);return 127!==t&&(!(t<=31)||(10===t||13===t))}))).join("")},Ca.attributeWrapSign='"',Ca.cssFilter=Ka,Ca.getDefaultCSSWhiteList=Ja;var ms={},bs=qa;function ws(e){var t,r=bs.spaceIndex(e);return t=-1===r?e.slice(1,-1):e.slice(1,r+1),"/"===(t=bs.trim(t).toLowerCase()).slice(0,1)&&(t=t.slice(1)),"/"===t.slice(-1)&&(t=t.slice(0,-1)),t}function js(e){return"</"===e.slice(0,2)}var ks=/[^a-zA-Z0-9\\_:.-]/gim;function Ss(e,t){for(;t<e.length;t++){var r=e[t];if(" "!==r)return"="===r?t:-1}}function Os(e,t){for(;t<e.length;t++){var r=e[t];if(" "!==r)return"'"===r||'"'===r?t:-1}}function xs(e,t){for(;t>0;t--){var r=e[t];if(" "!==r)return"="===r?t:-1}}function _s(e){return function(e){return'"'===e[0]&&'"'===e[e.length-1]||"'"===e[0]&&"'"===e[e.length-1]}(e)?e.substr(1,e.length-2):e}ms.parseTag=function(e,t,r){var n="",o=0,i=!1,a=!1,s=0,u=e.length,c="",l="";e:for(s=0;s<u;s++){var f=e.charAt(s);if(!1===i){if("<"===f){i=s;continue}}else if(!1===a){if("<"===f){n+=r(e.slice(o,s)),i=s,o=s;continue}if(">"===f||s===u-1){n+=r(e.slice(o,i)),c=ws(l=e.slice(i,s+1)),n+=t(i,n.length,c,l,js(l)),o=s+1,i=!1;continue}if('"'===f||"'"===f)for(var d=1,p=e.charAt(s-d);""===p.trim()||"="===p;){if("="===p){a=f;continue e}p=e.charAt(s-++d)}}else if(f===a){a=!1;continue}}return o<u&&(n+=r(e.substr(o))),n},ms.parseAttr=function(e,t){var r=0,n=0,o=[],i=!1,a=e.length;function s(e,r){if(!((e=(e=bs.trim(e)).replace(ks,"").toLowerCase()).length<1)){var n=t(e,r||"");n&&o.push(n)}}for(var u=0;u<a;u++){var c,l=e.charAt(u);if(!1!==i||"="!==l)if(!1===i||u!==n)if(/\s|\n|\t/.test(l)){if(e=e.replace(/\s|\n|\t/g," "),!1===i){if(-1===(c=Ss(e,u))){s(bs.trim(e.slice(r,u))),i=!1,r=u+1;continue}u=c-1;continue}if(-1===(c=xs(e,u-1))){s(i,_s(bs.trim(e.slice(r,u)))),i=!1,r=u+1;continue}}else;else{if(-1===(c=e.indexOf(l,u+1)))break;s(i,bs.trim(e.slice(n+1,c))),i=!1,r=(u=c)+1}else i=e.slice(r,u),r=u+1,n='"'===e.charAt(r)||"'"===e.charAt(r)?r:Os(e,u+1)}return r<e.length&&(!1===i?s(e.slice(r)):s(i,_s(bs.trim(e.slice(r))))),bs.trim(o.join(" "))};var As=Va.FilterCSS,Ts=Ca,Is=ms,$s=Is.parseTag,Ms=Is.parseAttr,Es=qa;function Ps(e){return null==e}function Ds(e){(e=function(e){var t={};for(var r in e)t[r]=e[r];return t}(e||{})).stripIgnoreTag&&(e.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),e.onIgnoreTag=Ts.onIgnoreTagStripAll),e.whiteList||e.allowList?e.whiteList=function(e){var t={};for(var r in e)Array.isArray(e[r])?t[r.toLowerCase()]=e[r].map((function(e){return e.toLowerCase()})):t[r.toLowerCase()]=e[r];return t}(e.whiteList||e.allowList):e.whiteList=Ts.whiteList,this.attributeWrapSign=!0===e.singleQuotedAttributeValue?"'":Ts.attributeWrapSign,e.onTag=e.onTag||Ts.onTag,e.onTagAttr=e.onTagAttr||Ts.onTagAttr,e.onIgnoreTag=e.onIgnoreTag||Ts.onIgnoreTag,e.onIgnoreTagAttr=e.onIgnoreTagAttr||Ts.onIgnoreTagAttr,e.safeAttrValue=e.safeAttrValue||Ts.safeAttrValue,e.escapeHtml=e.escapeHtml||Ts.escapeHtml,this.options=e,!1===e.css?this.cssFilter=!1:(e.css=e.css||{},this.cssFilter=new As(e.css))}Ds.prototype.process=function(e){if(!(e=(e=e||"").toString()))return"";var t=this,r=t.options,n=r.whiteList,o=r.onTag,i=r.onIgnoreTag,a=r.onTagAttr,s=r.onIgnoreTagAttr,u=r.safeAttrValue,c=r.escapeHtml,l=t.attributeWrapSign,f=t.cssFilter;r.stripBlankChar&&(e=Ts.stripBlankChar(e)),r.allowCommentTag||(e=Ts.stripCommentTag(e));var d=!1;r.stripIgnoreTagBody&&(d=Ts.StripTagBody(r.stripIgnoreTagBody,i),i=d.onIgnoreTag);var p=$s(e,(function(e,t,r,d,p){var h={sourcePosition:e,position:t,isClosing:p,isWhite:Object.prototype.hasOwnProperty.call(n,r)},g=o(r,d,h);if(!Ps(g))return g;if(h.isWhite){if(h.isClosing)return"</"+r+">";var v=function(e){var t=Es.spaceIndex(e);if(-1===t)return{html:"",closing:"/"===e[e.length-2]};var r="/"===(e=Es.trim(e.slice(t+1,-1)))[e.length-1];return r&&(e=Es.trim(e.slice(0,-1))),{html:e,closing:r}}(d),y=n[r],m=Ms(v.html,(function(e,t){var n=-1!==Es.indexOf(y,e),o=a(r,e,t,n);return Ps(o)?n?(t=u(r,e,t,f))?e+"="+l+t+l:e:Ps(o=s(r,e,t,n))?void 0:o:o}));return d="<"+r,m&&(d+=" "+m),v.closing&&(d+=" /"),d+=">"}return Ps(g=i(r,d,h))?c(d):g}),c);return d&&(p=d.remove(p)),p};var Cs=Ds;!function(e,t){var r=Ca,n=ms,o=Cs;function i(e,t){return new o(t).process(e)}(t=e.exports=i).filterXSS=i,t.FilterXSS=o,function(){for(var e in r)t[e]=r[e];for(var o in n)t[o]=n[o]}(),"undefined"!=typeof window&&(window.filterXSS=e.exports),"undefined"!=typeof self&&"undefined"!=typeof DedicatedWorkerGlobalScope&&self instanceof DedicatedWorkerGlobalScope&&(self.filterXSS=e.exports)}(Da,Da.exports);var Us=s(Da.exports);function Ns(e){let t=function e(t){return kr(t)||Zt(t)?(ft(t,(function(r,n){t[n]=e(r)})),t):Qt(t)?Us(t,{onIgnoreTagAttr:function(e,t,r,n){if("style"===t)return t+'="'+Us.escapeAttrValue(r)+'"'}}):t}(ri(e));return t}let Bs=null,Fs=null;function Rs(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"save";if(!Jt(Bs))throw console.log("ds",Bs),new Error("invalid ds");let o=Bs[e].keys,i=!1;kr(r)||(i=!0,r=[r]);let a=Pa();return n.indexOf("insert")>=0&&(o.indexOf("userId")>=0&&ft(r,((e,n)=>{r[n].userId=t})),o.indexOf("timeCreate")>=0&&ft(r,((e,t)=>{r[t].timeCreate=a})),o.indexOf("userIdUpdate")>=0&&ft(r,((e,n)=>{r[n].userIdUpdate=t})),o.indexOf("timeUpdate")>=0&&ft(r,((e,t)=>{r[t].timeUpdate=a}))),(n.indexOf("insert")>=0||n.indexOf("save")>=0)&&(o.indexOf("userIdUpdate")>=0&&ft(r,((e,n)=>{r[n].userIdUpdate=t})),o.indexOf("timeUpdate")>=0&&ft(r,((e,t)=>{r[t].timeUpdate=a}))),r=Hn(r,((e,t)=>{let r={};return ft(e,((e,t)=>{e=Ns(e),r[t]=e})),r})),r=i?r[0]:r}async function Ls(e,t,r,n){let o,i=null;if(!Jt(Fs))return Promise.reject("無有效woItems");let a=xe(Fs,t,null);if(null===a)return Promise.reject(`ORM找不到表名稱: ${t}`);if("select"===r){if(o=await a.select(n).catch((e=>{console.log(`${t}.select catch`,e),i="取得資料失敗"})),Qt(i))return Promise.reject(i)}else if("insert"===r||"save"===r){try{n=Rs(t,e,n,r)}catch(e){return console.log("adjustData catch",e.toString()),i="調整資料失敗",Promise.reject(i)}if("insert"===r?o=await a.insert(n).catch((e=>{console.log(`${t}.save catch`,e),i="新增資料失敗"})):"save"===r&&(o=await a.save(n,{atomic:!0}).catch((e=>{console.log(`${t}.save catch`,e),i="儲存資料失敗"}))),Qt(i))return Promise.reject(i);o=kr(n)?Hn(n,(e=>({id:e.id}))):{id:n.id}}else if("del"===r)o=await a.del(n).catch((e=>{console.log(`${t}.del catch`,e),i="刪除資料失敗"}));else if("delAll"===r)o=await a.delAll(n).catch((e=>{console.log(`${t}.delAll catch`,e),i="刪除資料失敗"}));else if("mix"===r){if(!Jt(n))return Promise.reject("mix僅支援輸入ltdtDiffByKey結果物件");let r;o=[];let s=xe(n,"add",[]);if(qt(s)>0){try{s=Rs(t,e,s,"insert+save")}catch(e){return console.log("adjustData catch",e.toString()),i="調整資料失敗",Promise.reject(i)}if(await a.insert(s).catch((e=>{console.log(`${t}.save catch`,e),i="新增資料失敗"})),Qt(i))return Promise.reject(i);r=Hn(s,(e=>({id:e.id}))),o=[...o,...r]}let u=xe(n,"del",[]);if(qt(u)>0){if(await a.del(u).catch((e=>{console.log(`${t}.save catch`,e),i="刪除資料失敗"})),Qt(i))return Promise.reject(i);r=Hn(u,(e=>({id:e.id}))),o=[...o,...r]}let c=xe(n,"diff",[]);if(qt(c)>0){try{c=Rs(t,e,c)}catch(e){return console.log("adjustData catch",e.toString()),i="調整資料失敗",Promise.reject(i)}if(await a.save(c).catch((e=>{console.log(`${t}.save catch`,e),i="變更資料失敗"})),Qt(i))return Promise.reject(i);r=Hn(c,(e=>({id:e.id}))),o=[...o,...r]}}else i=`invalid mode: ${r}`;return Qt(i)?Promise.reject(i):o}function Ws(e,t){return Bs=e,Fs=t,Ls}function zs(e,t){var r=[];return ct(e,(function(e,n,o){t(e,n,o)&&r.push(e)})),r}function Hs(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!kr(e)){let e=Er();return e.reject("pms is not an array"),e}return e.reduce(((e,t)=>e.then(t)),Promise.resolve(t))}let Gs=[],Ys=[],Vs=[],qs=null,Zs=null,Js=!0,Xs=!0;function Qs(e){setTimeout((()=>{Gs.push(e)}),1)}function Ks(e){setTimeout((()=>{Ys.push(e)}),1)}function eu(e){setTimeout((()=>{Vs.push(e)}),1)}async function tu(e,t,r,n){if(!Ar(qs))return Promise.reject("invalid mapOrm");if(Js&&!Qt(e))return console.log("userId",e),console.log("找不到使用者主鍵"),Promise.reject("找不到使用者主鍵");let o="n";if(Js){if(!Ar(Zs))return Promise.reject("invalid getUserById");let t=await Zs(e);if(!t)return console.log("userId",e),console.log("找不到使用者資訊"),Promise.reject("找不到使用者資訊");o=xe(t,"isAdmin"),"y"!==o&&"n"!==o&&(o="n");let r=xe(t,"isActive");if("y"!==r&&"n"!==r&&(r="n"),"y"!==r)return console.log("userId",e),console.log("oSelf",t),console.log("使用者被停權或無有效使用者資訊"),Promise.reject("使用者被停權或無有效使用者資訊")}if(await Cr(Gs,(i=>i({woName:t,userId:e,isAdmin:o,mode:r,input:n}))),qt(Ys)>0){let i={woName:t,userId:e,isAdmin:o,mode:r,input:n},a=await Hs(Ys,i);n=a.input}let i=await qs(e,t,r,n);var a,s;return Xs&&"n"===o&&"select"===r&&kr(i)&&(s=e=>!(ni(e,"isActive")&&"n"===e.isActive),i=(l(a=i)?yn:zs)(a,Wn(s))),qt(Vs)>0&&(i=await Hs(Vs,{woName:t,userId:e,isAdmin:o,mode:r,input:n,output:i})),i}function ru(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function nu(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ru(Object(r),!0).forEach((function(t){sa(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ru(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ou(e,t,r,n){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},i=function(e,t,r,n){if(!Jt(e))throw console.log("ds",e),new Error("invalid ds");if(!Ar(t))throw console.log("WOrm",t),new Error("invalid WOrm");if(!Qt(r))throw console.log("url",r),new Error("invalid url");if(!Qt(n))throw console.log("db",n),new Error("invalid db");let o={};return ft(st(e),(e=>{let i=new t({url:r,db:n,cl:e});o[e]=i})),o}(e,t,r,n),a=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Ar(e)?(qs=e,Js=xe(t,"bCheckUser"),Fr(Js)||(Js=!0),Zs=xe(t,"getUserById"),Xs=xe(t,"bExcludeWhenNotAdmin"),Fr(Xs)||(Xs=!0),{addFunCheck:Qs,addFunPreProcessing:Ks,addFunPostProcessing:eu,procOrm:tu}):Promise.reject("invalid mapOrm")}(Ws(e,i),o);return nu(nu({},Ea),{},{woItems:i},a)}function iu(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(!_r(t))return{};let n={};return ft(t,(function(t){n[t]=xe(e,t,r)})),n}function au(){if(!Ar(c))throw new Error("invalid dayjs");return c().format("YYYYMMDDHHmmss")}let su={id:{pk:!0,name:"主鍵",type:"STRING"},token:{name:"金鑰",type:"STRING"},userId:{name:"使用者主鍵",type:"STRING"},timeCreate:{name:"創建時間",type:"STRING"},timeEnd:{name:"到期時間",type:"STRING"},timeUpdate:{name:"更新時間",type:"STRING"}},uu={keyTable:"tokens",tableNameCht:"金鑰",tableNameEng:"Tokens",settings:su,funNew:function(){let e=iu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},st(su));return e.id=`${au()}-${Ni()}`,e.token=`${au()}-${Ni()}`,e.timeCreate=Pa(),e.timeEnd=c().add(30,"minute").format(),e.timeUpdate=e.timeCreate,e},funTest:()=>[]},cu={id:{pk:!0,name:"主鍵",type:"STRING"},order:{name:"順序",type:"INTEGER"},account:{name:"帳號",type:"STRING"},password:{name:"密碼",type:"STRING"},name:{name:"姓名",type:"STRING"},email:{name:"電子郵件",type:"STRING"},description:{name:"描述",type:"TEXT"},from:{name:"來源",type:"STRING"},ruleGroupsIds:{name:"所屬權限群組主鍵",type:"STRING"},redir:{name:"登入後轉址",type:"STRING"},isAdmin:{name:"是否為系統管理員",type:"STRING"},userId:{name:"創建使用者主鍵",type:"STRING"},timeCreate:{name:"創建時間",type:"STRING"},userIdUpdate:{name:"最新變更使用者主鍵",type:"STRING"},timeUpdate:{name:"更新時間",type:"STRING"},isActive:{name:"是否有效",type:"STRING"}},lu={keyTable:"users",tableNameCht:"使用者",tableNameEng:"Users",settings:cu,funNew:function(){let e=iu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},st(cu));return e.id=`${au()}-${Ni()}`,e.isAdmin="n",e.userIdUpdate=e.userId,e.timeCreate=Pa(),e.timeUpdate=e.timeCreate,e.isActive="y",e},funTest:()=>[]};function fu(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function du(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?fu(Object(r),!0).forEach((function(t){sa(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fu(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function pu(e){let t=xe(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},"useCreateStorage");Fr(t)||(t=!1);let{keyTable:r,tableNameCht:n,tableNameEng:o,settings:i,parser:a,funNew:s,funTest:u,ext:c}=e;if(!Qt(r))throw new Error(`invalid keyTable[${r}]`);if(Qt(n)||(n=r),Qt(o)||(o=r),!Jt(i))throw new Error("invalid settings");Jt(c)||(c=null),Jt(a)||(a=null),Ar(s)||(s=null);let l=null;Ar(u)&&(l=async e=>{if(!Jt(e))throw new Error("invalid wo");if(!ni(e,r))throw console.log(e),new Error(`keyTable[${r}] is not in wo`);let n=[];try{n=u(),Tr(n)&&(n=await n)}catch(e){throw console.log(`keyTable[${r}] funTest catch`,e),new Error(e)}if(0!==qt(n))return t&&await e[r].createStorage(),await e[r].save(n),n});let f={},d={};return ft(st(i),(e=>{let t=xe(i,`${e}.name`,"");Qt(t)&&(f[e]=t);let r=xe(i,`${e}.type`,"");Qt(r)&&(d[e]=r)})),du(du({},e),{},{keyTable:r,tableNameCht:n,tableNameEng:o,settings:i,keys:st(i),kpType:d,kpHead:f,parser:a,funNew:s,funTest:u,funTestAndSave:l,ext:c})}let hu={tokens:uu,users:lu},gu={};for(let e in hu)gu[e]=pu(hu[e],{useCreateStorage:!1});var vu,yu={exports:{}},mu={exports:{}};!function(e,t){var r;e.exports=(r=ki(),vu||(vu=1,function(e,t){var r,n,o,i,a,s,u;e.exports=(o=(n=u=ki()).lib,i=o.Base,a=o.WordArray,(s=n.x64={}).Word=i.extend({init:function(e,t){this.high=e,this.low=t}}),s.WordArray=i.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=t!=r?t:8*e.length},toX32:function(){for(var e=this.words,t=e.length,r=[],n=0;n<t;n++){var o=e[n];r.push(o.high),r.push(o.low)}return a.create(r,this.sigBytes)},clone:function(){for(var e=i.clone.call(this),t=e.words=this.words.slice(0),r=t.length,n=0;n<r;n++)t[n]=t[n].clone();return e}}),u)}(mu)),function(){var e=r,t=e.lib.Hasher,n=e.x64,o=n.Word,i=n.WordArray,a=e.algo;function s(){return o.create.apply(o,arguments)}var u=[s(1116352408,3609767458),s(1899447441,602891725),s(3049323471,3964484399),s(3921009573,2173295548),s(961987163,4081628472),s(1508970993,3053834265),s(2453635748,2937671579),s(2870763221,3664609560),s(3624381080,2734883394),s(310598401,1164996542),s(607225278,1323610764),s(1426881987,3590304994),s(1925078388,4068182383),s(2162078206,991336113),s(2614888103,633803317),s(3248222580,3479774868),s(3835390401,2666613458),s(4022224774,944711139),s(264347078,2341262773),s(604807628,2007800933),s(770255983,1495990901),s(1249150122,1856431235),s(1555081692,3175218132),s(1996064986,2198950837),s(2554220882,3999719339),s(2821834349,766784016),s(2952996808,2566594879),s(3210313671,3203337956),s(3336571891,1034457026),s(3584528711,2466948901),s(113926993,3758326383),s(338241895,168717936),s(666307205,1188179964),s(773529912,1546045734),s(1294757372,1522805485),s(1396182291,2643833823),s(1695183700,2343527390),s(1986661051,1014477480),s(2177026350,1206759142),s(2456956037,344077627),s(2730485921,1290863460),s(2820302411,3158454273),s(3259730800,3505952657),s(3345764771,106217008),s(3516065817,3606008344),s(3600352804,1432725776),s(4094571909,1467031594),s(275423344,851169720),s(430227734,3100823752),s(506948616,1363258195),s(659060556,3750685593),s(883997877,3785050280),s(958139571,3318307427),s(1322822218,3812723403),s(1537002063,2003034995),s(1747873779,3602036899),s(1955562222,1575990012),s(2024104815,1125592928),s(2227730452,2716904306),s(2361852424,442776044),s(2428436474,593698344),s(2756734187,3733110249),s(3204031479,2999351573),s(3329325298,3815920427),s(3391569614,3928383900),s(3515267271,566280711),s(3940187606,3454069534),s(4118630271,4000239992),s(116418474,1914138554),s(174292421,2731055270),s(289380356,3203993006),s(460393269,320620315),s(685471733,587496836),s(852142971,1086792851),s(1017036298,365543100),s(1126000580,2618297676),s(1288033470,3409855158),s(1501505948,4234509866),s(1607167915,987167468),s(1816402316,1246189591)],c=[];!function(){for(var e=0;e<80;e++)c[e]=s()}();var l=a.SHA512=t.extend({_doReset:function(){this._hash=new i.init([new o.init(1779033703,4089235720),new o.init(3144134277,2227873595),new o.init(1013904242,4271175723),new o.init(2773480762,1595750129),new o.init(1359893119,2917565137),new o.init(2600822924,725511199),new o.init(528734635,4215389547),new o.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],o=r[1],i=r[2],a=r[3],s=r[4],l=r[5],f=r[6],d=r[7],p=n.high,h=n.low,g=o.high,v=o.low,y=i.high,m=i.low,b=a.high,w=a.low,j=s.high,k=s.low,S=l.high,O=l.low,x=f.high,_=f.low,A=d.high,T=d.low,I=p,$=h,M=g,E=v,P=y,D=m,C=b,U=w,N=j,B=k,F=S,R=O,L=x,W=_,z=A,H=T,G=0;G<80;G++){var Y,V,q=c[G];if(G<16)V=q.high=0|e[t+2*G],Y=q.low=0|e[t+2*G+1];else{var Z=c[G-15],J=Z.high,X=Z.low,Q=(J>>>1|X<<31)^(J>>>8|X<<24)^J>>>7,K=(X>>>1|J<<31)^(X>>>8|J<<24)^(X>>>7|J<<25),ee=c[G-2],te=ee.high,re=ee.low,ne=(te>>>19|re<<13)^(te<<3|re>>>29)^te>>>6,oe=(re>>>19|te<<13)^(re<<3|te>>>29)^(re>>>6|te<<26),ie=c[G-7],ae=ie.high,se=ie.low,ue=c[G-16],ce=ue.high,le=ue.low;V=(V=(V=Q+ae+((Y=K+se)>>>0<K>>>0?1:0))+ne+((Y+=oe)>>>0<oe>>>0?1:0))+ce+((Y+=le)>>>0<le>>>0?1:0),q.high=V,q.low=Y}var fe,de=N&F^~N&L,pe=B&R^~B&W,he=I&M^I&P^M&P,ge=$&E^$&D^E&D,ve=(I>>>28|$<<4)^(I<<30|$>>>2)^(I<<25|$>>>7),ye=($>>>28|I<<4)^($<<30|I>>>2)^($<<25|I>>>7),me=(N>>>14|B<<18)^(N>>>18|B<<14)^(N<<23|B>>>9),be=(B>>>14|N<<18)^(B>>>18|N<<14)^(B<<23|N>>>9),we=u[G],je=we.high,ke=we.low,Se=z+me+((fe=H+be)>>>0<H>>>0?1:0),Oe=ye+ge;z=L,H=W,L=F,W=R,F=N,R=B,N=C+(Se=(Se=(Se=Se+de+((fe+=pe)>>>0<pe>>>0?1:0))+je+((fe+=ke)>>>0<ke>>>0?1:0))+V+((fe+=Y)>>>0<Y>>>0?1:0))+((B=U+fe|0)>>>0<U>>>0?1:0)|0,C=P,U=D,P=M,D=E,M=I,E=$,I=Se+(ve+he+(Oe>>>0<ye>>>0?1:0))+(($=fe+Oe|0)>>>0<fe>>>0?1:0)|0}h=n.low=h+$,n.high=p+I+(h>>>0<$>>>0?1:0),v=o.low=v+E,o.high=g+M+(v>>>0<E>>>0?1:0),m=i.low=m+D,i.high=y+P+(m>>>0<D>>>0?1:0),w=a.low=w+U,a.high=b+C+(w>>>0<U>>>0?1:0),k=s.low=k+B,s.high=j+N+(k>>>0<B>>>0?1:0),O=l.low=O+R,l.high=S+F+(O>>>0<R>>>0?1:0),_=f.low=_+W,f.high=x+L+(_>>>0<W>>>0?1:0),T=d.low=T+H,d.high=A+z+(T>>>0<H>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[30+(n+128>>>10<<5)]=Math.floor(r/4294967296),t[31+(n+128>>>10<<5)]=r,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=t.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32});e.SHA512=t._createHelper(l),e.HmacSHA512=t._createHmacHelper(l)}(),r.SHA512)}(yu);var bu=s(yu.exports),wu={exports:{}};!function(e,t){e.exports=ki().enc.Hex}(wu);var ju=s(wu.exports);function ku(e,t){let r=xe(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},"mode","");if(Qt(r)||(r="sha512"),"sha512"!==r)throw new Error("暫時不支援sha512以外方法");let n=`${e}:${t}`;return n=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!Qt(e))return"";if(!Fr(t))return"";let r=bu(e),n="";return n=t?r.toString(xi):r.toString(ju),n}(n),n}function Su(e,t){let{salt:r,timeExpired:n}=t,o=async t=>{let r=await(async(t,r)=>{let n=xe(await e.users.select({[t]:r,isActive:"y"}),0,null);return Jt(n)?n:null})("account",t);return Jt(r)?r:null},i=async t=>{let r=null,o=gu.tokens.funNew({userId:t});o.timeEnd=c().add(n,"minute").format("YYYY-MM-DDTHH:mm:ss.SSSZ");let i=xe(o,"token","");return await e.tokens.insert(o).catch((e=>{r=e})),r?(console.log(r),console.log("token",i),console.log("Can not create a token from userId"),Promise.reject("Can not create a token from userId")):i},a=async e=>{let t=xe(e,"timeEnd",""),r=c(t,"YYYY-MM-DDTHH:mm:ss.SSSZ"),o=c(),i=r.diff(o,"minutes");return!(i>n)||(console.log("tk",e),console.log("dmin",i,"timeExpired",n),console.log("token expired"),Promise.reject("token expired"))},s=async t=>{let r=await e.tokens.select({token:t}),n=qt(r);if(0===n)return console.log("token",t),console.log("invalid token"),Promise.reject("invalid token");if(n>=2)return console.log("token",t),console.log("duplicate tokens"),Promise.reject("duplicate tokens");let o=xe(r,0,"");return await a(o),!0};return{loginByAccountAndPassword:async(e,t)=>{let n=ku(t,r),a=await o(e);if(!Jt(a))return console.log("account",e),console.log("can not find the user from account"),Promise.reject("can not find the user from account");if(n!==xe(a,"password",""))return Promise.reject("incorrect user account or password");let s=xe(a,"id",""),u=await i(s);return{id:a.id,account:a.account,name:a.name,email:a.email,description:a.description,from:a.from,ruleGroupsIds:a.ruleGroupsIds,redir:a.redir,isAdmin:a.isAdmin,isActive:a.isActive,token:u}},checkToken:s,refreshToken:async t=>{let r=null,o=await e.tokens.select({token:t}),i=qt(o);if(0===i)return console.log("token",t),console.log("invalid token"),Promise.reject("invalid token");if(i>=2)return console.log("token",t),console.log("duplicate tokens"),Promise.reject("duplicate tokens");let a=xe(o,0,""),s=xe(a,"timeEnd",""),u=c(s,"YYYY-MM-DDTHH:mm:ss.SSSZ"),l=c(),f=u.diff(l,"minutes");if(f>n)return console.log("token",t),console.log("dmin",f,"timeExpired",n),console.log("token expired"),Promise.reject("token expired");let d=l.format("YYYY-MM-DDTHH:mm:ss.SSSZ");return await e.tokens.save({id:a.id,timeEnd:d}).catch((e=>{r=e})),!r||(console.log(r),console.log("token",t),console.log("Can not update time for token"),Promise.reject("Can not update time for token"))},getUserByToken:async t=>{let r=null,n=await e.tokens.select({token:t}),o=qt(n);if(0===o)return console.log("token",t),console.log("invalid token"),Promise.reject("invalid token");if(o>=2)return console.log("token",t),console.log("duplicate tokens"),Promise.reject("duplicate tokens");let i=xe(n,0,""),a=xe(i,"userId",""),s=await e.users.select({id:a}).catch((e=>{r=e}));if(r)return console.log(r),console.log("userId",a),console.log("Failed to find user"),Promise.reject("Failed to find user");let u=qt(s);if(0===u)return console.log("userId",a),console.log("can not find the user by userId"),Promise.reject("can not find the user by userId");if(u>=2)return console.log("userId",a),console.log("duplicate userId"),Promise.reject("duplicate userId");let c=xe(s,0,"");return{id:c.id,account:c.account,name:c.name,email:c.email,description:c.description,from:c.from,ruleGroupsIds:c.ruleGroupsIds,redir:c.redir,isAdmin:c.isAdmin,isActive:c.isActive,token:t}},logOutByToken:async t=>{let r=null,n=await e.tokens.select({token:t}),o=qt(n);if(0===o)return console.log("token",t),console.log("invalid token"),Promise.reject("invalid token");if(o>=2)return console.log("token",t),console.log("duplicate tokens"),Promise.reject("duplicate tokens");let i=xe(n,0,"");xe(i,"userId","");let a=await e.tokens.del({id:i.id}).catch((e=>{r=e}));return r?(console.log(r),console.log("token",t),console.log("Failed to delete token"),Promise.reject("Failed to delete token")):(a=xe(a,"0.nDeleted",0),1===a||(console.log("token",t),console.log("Can not delete the token"),Promise.reject("Can not delete the token")))},cleanTokens:async()=>{let t=await e.tokens.select(),r=[];await Cr(t,(async e=>{let t=null;await a(e).catch((e=>{t=e})),t&&r.push(e)})),qt(r)>0&&await Cr(t,(async t=>{await e.tokens.del({id:t.id}).catch((()=>{}))}))},createUser:async()=>{},ModifyUser:async()=>{},DeleteUser:async()=>{},AuthUser:async()=>{},EmailUser:async()=>{},getUsersList:async t=>(await s(t),await e.users.select()),getUserInfor:async(t,r,n)=>{await s(t);let o=xe(await e.users.select({[r]:n,isActive:"y"}),0,{});return Jt(o)?{id:o.id,account:o.account,name:o.name,email:o.email,description:o.description,from:o.from,ruleGroupsIds:o.ruleGroupsIds,redir:o.redir,isAdmin:o.isAdmin,isActive:o.isActive,token:t}:(console.log("token",t),console.log("key",r,"value",n),console.log("Can not find user"),Promise.reject("Can not find user"))}}}return function(r,n,o,i,a,s){let u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{},c=null;if(!Ar(r))throw console.log("invalid WOrm",r),new Error("invalid WOrm");if(!Qt(n))throw console.log("invalid url",n),new Error("invalid url");if(!Qt(o))throw console.log("invalid db",o),new Error("invalid db");if(!Ar(i))throw console.log("invalid getUserByToken",i),new Error("invalid getUserByToken");if(!Ar(a))throw console.log("invalid verifyBrowserUser",a),new Error("invalid verifyBrowserUser");if(!Ar(s))throw console.log("invalid verifyAppUser",s),new Error("invalid verifyAppUser");let l=xe(u,"serverPort");jr(l)||(l=11007),l=wr(l);let f=xe(u,"bCheckUser",!1),d=xe(u,"getUserById",null),p=xe(u,"bExcludeWhenNotAdmin",!1),h=xe(u,"webName",{}),g=xe(u,"webDescription",{}),v=xe(u,"webLogo",""),y=xe(u,"webBackgoundGradientColors",[]);_r(y)||(y=["#FFE0B2","#FFCC80","#FFF59D"]);let m=xe(u,"webKey",""),b=xe(u,"salt",""),w=xe(u,"timeExpired","");var j;pr(j=w)&&hr(j)>0&&(w=30);let k=xe(u,"subfolder","");var S,O;Qt(k)&&("/"===function(e,t){if(!Qt(e))return"";if(!$r(t))return"";if(0===(t=wr(t)))return"";let r=e.length-t;return r<0&&(r=0),e.substring(r,r+t)}(k,1)&&(O=1,k=Qt(S=k)&&$r(O)?0===(O=wr(O))?S:Mr(S,S.length-O):""),"/"!==Mr(k,1)&&(k=`/${k}`)),xe(u,"mappingBy","");let x={bCheckUser:f,getUserById:d,bExcludeWhenNotAdmin:p},_={};try{_=ou(gu,r,n,o,x)}catch(e){console.log(e)}let{woItems:A,procOrm:T}=_,I=e=>({webName:h,webDescription:g,webLogo:v,webBackgoundGradientColors:y,webKey:m}),$=Su(A,{salt:b,timeExpired:w}),M="none";setInterval((()=>{"doing"!==M&&(M="doing",$.cleanTokens().finally((()=>{M="none"})))}),1e3);let E="dist",P="./node_modules/w-web-sso/dist";var D;D=P,!t.existsSync(D)||t.lstatSync(D).isFile()||t.lstatSync(D).isSymbolicLink()||(E=P);let C="index.html";try{let r=e.resolve(E,"index.tmp");if(Ur(r)||(r=e.resolve(E,C)),!Ur(r))throw console.log("fpEntryIn",r),new Error("invalid fpEntryIn");let n=e.resolve(E,C),o=t.readFileSync(r,"utf8");o=Nr(o,"/msso/","{sfd}/"),o=Nr(o,"{sfd}",k),t.writeFileSync(n,o,"utf8")}catch(e){console.log(e),console.log(`can not generate ${C}`)}let U=[{method:"GET",path:"/getWebInfor",handler:async function(e,t){return I()}},{method:"GET",path:"/api/logoutSsoUser",handler:async function(e,t){return await Pr((async function(){let t=xe(e,"query.token","");return await $.logOutByToken(t)}))()}},{method:"GET",path:"/api/checkToken",handler:async function(e,t){return await Pr((async function(){let t=xe(e,"query.token","");return await $.checkToken(t)}))()}},{method:"GET",path:"/api/getSsoUsersList",handler:async function(e,t){return await Pr((async function(){let t=xe(e,"query.token","");return await $.getUsersList(t)}))()}},{method:"GET",path:"/api/getSsoUserInfor",handler:async function(e,t){return await Pr((async function(){let t=xe(e,"query.token",""),r=xe(e,"query.key",""),n=xe(e,"query.value",""),o=null;return o="token"===r?await $.getUserByToken(n):await $.getUserInfor(t,r,n),Jt(o)?o:(console.log("token",t),console.log("key",r,"value",n),console.log("token does not have permission"),Promise.reject("token does not have permission"))}))()}}],N=st(gu);return c=new ga({port:u.serverPort,pathStaticFiles:E,apis:U,getUserIDFromToken:async e=>"",useDbORM:!0,dbORMs:A,operORM:T,tableNamesExec:N,methodsExec:["select","insert","save","del","delAll"],tableNamesSync:[],extFuncs:{getWebInfor:I,getUserByToken:(e,t)=>$.getUserByToken(t),loginByAccountAndPassword:(e,t,r)=>$.loginByAccountAndPassword(t,r),checkToken:(e,t)=>$.checkToken(t),refreshToken:(e,t)=>$.refreshToken(t),logOutByToken:(e,t)=>$.logOutByToken(t),getUsersList:(e,t)=>$.getUsersList(t)},hookBefores:null,hookAfters:null,fnTableTags:"tableTags-web-sso.json"}),c}}));
//# sourceMappingURL=w-web-sso.umd.js.map
